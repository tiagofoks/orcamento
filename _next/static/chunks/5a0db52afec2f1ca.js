(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,17386,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],h=new i((a+o)*3/4-o),u=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],h[u++]=t>>16&255,h[u++]=t>>8&255,h[u++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,h[u++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,h[u++]=t>>8&255,h[u++]=255&t),h},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(n,i),l=a(s),h=l.write(n,i);return h!==s&&(l=l.slice(0,h)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(N(e,ArrayBuffer)||e&&N(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(N(e,SharedArrayBuffer)||e&&N(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var u=e.valueOf&&e.valueOf();if(null!=u&&u!==e)return o.from(u,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return h(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(h(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return u(e)},o.allocUnsafeSlow=function(e){return u(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||N(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return _(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return A(e).length;default:if(i)return n?-1:_(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=D[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return v(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,s=t,a=r,0===s&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function h(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var u=-1;for(s=r;s<o;s++)if(h(e,s)===h(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===l)return u*a}else -1!==u&&(s-=s-u),u=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(h(e,s+d)!==h(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(N(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),N(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(N(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(N(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),h=this.slice(n,i),u=e.slice(t,r),c=0;c<l;++c)if(h[c]!==u[c]){s=h[c],a=u[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)};function v(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,h=e[i],u=null,c=h>239?4:h>223?3:h>191?2:1;if(i+c<=r)switch(c){case 1:h<128&&(u=h);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&h)<<6|63&s)>127&&(u=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&h)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&h)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(u=l)}null===u?(u=65533,c=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",m=0;m<f;)p+=String.fromCharCode.apply(String,d.slice(m,m+=4096));return p}function w(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function b(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function E(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function T(e,t,r,n,s){return t*=1,r>>>=0,s||E(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function x(e,t,r,n,s){return t*=1,r>>>=0,s||E(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,h,u,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,I(_(e,this.length-i),this,i,s);case"ascii":return a=t,o=r,I(C(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return I(C(t),e,r,n)}(this,e,t,r);case"base64":return l=t,h=r,I(A(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,c=r,I(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-u),this,u,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return T(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return T(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return x(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return x(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var S=/[^+/0-9A-Za-z-_]/g;function _(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function C(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function A(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(S,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function I(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function N(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var D=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,h=l>>1,u=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=o;u>0;s=256*s+e[t+c],c+=d,u-=8);for(a=s&(1<<-u)-1,s>>=-u,u+=n;u>0;a=256*a+e[t+c],c+=d,u-=8);if(0===s)s=1-h;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=h}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,h=8*s-i-1,u=(1<<h)-1,c=u>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,p=n?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=u?(o=0,a=u):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,h+=i;h>0;e[r+f]=255&a,f+=p,a/=256,h-=8);e[r+f-p]|=128*m}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab="/ROOT/dev/orcamento/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},18926,e=>{"use strict";let t,r,n;var i,s,a,o,l,h,u,c,d,f,p,m,g,y,v,w,b=e.i(36553),E=e.i(78411);let T=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},x=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var S={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let _=(0,E.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:i="",children:s,iconNode:a,...o},l)=>(0,E.createElement)("svg",{ref:l,...S,width:t,height:t,stroke:e,strokeWidth:n?24*Number(r)/Number(t):r,className:x("lucide",i),...!s&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(o)&&{"aria-hidden":"true"},...o},[...a.map(([e,t])=>(0,E.createElement)(e,t)),...Array.isArray(s)?s:[s]])),C=(e,t)=>{let r=(0,E.forwardRef)(({className:r,...n},i)=>(0,E.createElement)(_,{ref:i,iconNode:t,className:x(`lucide-${T(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...n}));return r.displayName=T(e),r},A=C("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),I=C("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),N=C("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),D=C("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),k=C("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),R=C("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),O=C("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),L=C("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),M=C("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),P=C("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),V=C("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),j=C("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),F=C("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),U=C("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),B=C("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),q=C("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var z=e.i(76937);let $=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},G=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},K={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,h=i>>2,u=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),n.push(r[h],r[u],r[c],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray($(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):G(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new H;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class H extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let Q=function(e){let t=$(e);return K.encodeByteArray(t,!0)},W=function(e){return Q(e).replace(/\./g,"")},X=function(e){try{return K.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},Y=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===z.default||void 0===z.default.env)return;let e=z.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&X(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},J=()=>Y()?.config;class Z{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function ee(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function et(e){return(await fetch(e,{credentials:"include"})).ok}let er={},en=!1;function ei(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}class es extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,es.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ea.prototype.create)}}class ea{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=i,r.replace(eo,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new es(s,l,i)}}let eo=/\{\$([^}]+)}/g;function el(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(eh(r)&&eh(s)){if(!el(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function eh(e){return null!==e&&"object"==typeof e}function eu(e){return e&&e._delegate?e._delegate:e}class ec{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ed="[DEFAULT]";class ef{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new Z;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ed})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ed){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ed){return this.instances.has(e)}getOptions(e=ed){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===ed?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=ed){return this.component?this.component.multipleInstances?e:ed:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ep{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new ef(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let em=[];(i=s||(s={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";let eg={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},ey=s.INFO,ev={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},ew=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=ev[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eb{constructor(e){this.name=e,this._logLevel=ey,this._logHandler=ew,this._userLogHandler=null,em.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eg[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}let eE=new WeakMap,eT=new WeakMap,ex=new WeakMap,eS=new WeakMap,e_=new WeakMap,eC={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return eT.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ex.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return eA(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eA(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eA(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&eE.set(t,e)}).catch(()=>{}),e_.set(t,e),t}if(eS.has(e))return eS.get(e);let n=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eI(this),t),eA(eE.get(this))}:function(...t){return eA(e.apply(eI(this),t))}:function(t,...r){let n=e.call(eI(this),t,...r);return ex.set(n,t.sort?t.sort():[t]),eA(n)};return e instanceof IDBTransaction&&function(e){if(eT.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eT.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eC):e}(e);return n!==e&&(eS.set(e,n),e_.set(n,e)),n}let eI=e=>e_.get(e),eN=["get","getKey","getAll","getAllKeys","count"],eD=["put","add","delete","clear"],ek=new Map;function eR(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(ek.get(t))return ek.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=eD.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||eN.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return ek.set(t,s),s}eC={...n=eC,get:(e,t,r)=>eR(e,t)||n.get(e,t,r),has:(e,t)=>!!eR(e,t)||n.has(e,t)};class eO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eL="@firebase/app",eM="0.14.6",eP=new eb("@firebase/app"),eV="[DEFAULT]",ej={[eL]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eF=new Map,eU=new Map,eB=new Map;function eq(e,t){try{e.container.addComponent(t)}catch(r){eP.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function ez(e,t){e.container.addOrOverwriteComponent(t)}function e$(e){let t=e.name;if(eB.has(t))return eP.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(eB.set(t,e),eF.values()))eq(r,e);for(let t of eU.values())eq(t,e);return!0}function eG(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eK(e,t,r=eV){eG(e,t).clearInstance(r)}function eH(e){return void 0!==e.options}function eQ(e){return!eH(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function eW(e){return null!=e&&void 0!==e.settings}function eX(){eB.clear()}let eY=new ea("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class eJ{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ec("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eY.create("app-deleted",{appName:this._name})}}function eZ(e,t){let r=X(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class e0 extends eJ{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&eZ(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&eZ(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,e8(eL,eM,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){e4(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw eY.create("server-app-deleted")}}let e1="12.6.0";function e2(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:eV,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw eY.create("bad-app-name",{appName:String(i)});if(r||(r=J()),!r)throw eY.create("no-options");let s=eF.get(i);if(s)if(el(r,s.options)&&el(n,s.config))return s;else throw eY.create("duplicate-app",{appName:i});let a=new ep(i);for(let e of eB.values())a.addComponent(e);let o=new eJ(r,n,a);return eF.set(i,o),o}function e3(e,t={}){let r;if(("undefined"!=typeof window||ei())&&!ei())throw eY.create("invalid-server-app-environment");let n=t||{};if(e&&(eH(e)?r=e.options:eQ(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=J()),!r)throw eY.create("no-options");let i={...n,...r};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==n.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw eY.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=eU.get(s);if(a)return a.incRefCount(n.releaseOnDeref),a;let o=new ep(s);for(let e of eB.values())o.addComponent(e);let l=new e0(r,n,s,o);return eU.set(s,l),l}function e6(e=eV){let t=eF.get(e);if(!t&&e===eV&&J())return e2();if(!t)throw eY.create("no-app",{appName:e});return t}function e5(){return Array.from(eF.values())}async function e4(e){let t=!1,r=e.name;eF.has(r)?(t=!0,eF.delete(r)):eU.has(r)&&0>=e.decRefCount()&&(eU.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function e8(e,t,r){let n=ej[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eP.warn(e.join(" "));return}e$(new ec(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function e7(e,t){if(null!==e&&"function"!=typeof e)throw eY.create("invalid-log-argument");for(let r of em){let n=null;t&&t.level&&(n=eg[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let a=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:s[r].toLowerCase(),message:a,args:i,type:t.name})}}}function e9(e){em.forEach(t=>{t.setLogLevel(e)})}let te="firebase-heartbeat-store",tt=null;function tr(){return tt||(tt=(function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=eA(a);return n&&a.addEventListener("upgradeneeded",e=>{n(eA(a.result),e.oldVersion,e.newVersion,eA(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(te)}catch(e){console.warn(e)}}}).catch(e=>{throw eY.create("idb-open",{originalErrorMessage:e.message})})),tt}async function tn(e){try{let t=(await tr()).transaction(te),r=await t.objectStore(te).get(ts(e));return await t.done,r}catch(e){if(e instanceof es)eP.warn(e.message);else{let t=eY.create("idb-get",{originalErrorMessage:e?.message});eP.warn(t.message)}}}async function ti(e,t){try{let r=(await tr()).transaction(te,"readwrite"),n=r.objectStore(te);await n.put(t,ts(e)),await r.done}catch(e){if(e instanceof es)eP.warn(e.message);else{let t=eY.create("idb-set",{originalErrorMessage:e?.message});eP.warn(t.message)}}}function ts(e){return`${e.name}!${e.options.appId}`}class ta{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tl(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=to();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eP.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=to(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),th(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),th(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=W(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return eP.warn(e),""}}}function to(){return new Date().toISOString().substring(0,10)}class tl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tn(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return ti(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return ti(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function th(e){return W(JSON.stringify({version:2,heartbeats:e})).length}e$(new ec("platform-logger",e=>new eO(e),"PRIVATE")),e$(new ec("heartbeat",e=>new ta(e),"PRIVATE")),e8(eL,eM,""),e8(eL,eM,"esm2020"),e8("fire-js",""),e.s(["SDK_VERSION",()=>e1,"_DEFAULT_ENTRY_NAME",()=>eV,"_addComponent",()=>eq,"_addOrOverwriteComponent",()=>ez,"_apps",()=>eF,"_clearComponents",()=>eX,"_components",()=>eB,"_getProvider",()=>eG,"_isFirebaseApp",()=>eH,"_isFirebaseServerApp",()=>eW,"_isFirebaseServerAppSettings",()=>eQ,"_registerComponent",()=>e$,"_removeServiceInstance",()=>eK,"_serverApps",()=>eU,"deleteApp",()=>e4,"getApp",()=>e6,"getApps",()=>e5,"initializeApp",()=>e2,"initializeServerApp",()=>e3,"onLog",()=>e7,"registerVersion",()=>e8,"setLogLevel",()=>e9],11289),e8("firebase","12.6.0","app"),e.i(11289);var tu=e.i(17386),tc="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,td={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var s,l={};function h(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new i([0|e],e<0?-1:0)}function u(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return g(u(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new i(t,0)}var c=h(0),d=h(1),f=h(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new i(r,~e.h).add(d)}function y(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function b(e,t){if(p(t))throw Error("division by zero");if(p(e))return new w(c,c);if(m(e))return t=b(g(e),t),new w(g(t.g),g(t.h));if(m(t))return t=b(e,g(t)),new w(g(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=E(r),n=E(n);var i=T(r,1),s=T(n,1);for(n=T(n,2),r=T(r,2);!p(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=T(n,1),r=T(r,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=c;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=u(r)).j(t);m(a)||a.l(e)>0;)r-=n,a=(s=u(r)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new w(i,e)}function E(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new i(r,e.h)}function T(e,t){let r=t>>5;t%=32;let n=e.g.length-r,s=[];for(let i=0;i<n;i++)s[i]=t>0?e.i(i+r)>>>t|e.i(i+r+1)<<32-t:e.i(i+r);return new i(s,e.h)}(s=i.prototype).m=function(){if(m(this))return-g(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(m(this))return"-"+g(this).toString(e);let t=u(Math.pow(e,6));var r=this;let n="";for(;;){let i=b(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return m(e=y(this,e))?-1:+!p(e)},s.abs=function(){return m(this)?g(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new i(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return c;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(f)&&0>e.l(f))return u(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,v(r,2*n+2*t),r[2*n+2*t+1]+=i*o,v(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,v(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,v(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new i(r,0)},s.B=function(e){return b(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new i(r,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new i(r,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new i(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,o=td.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=u,i.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=u(Math.pow(r,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=u(Math.pow(r,s)),i=i.j(s).add(u(a))):i=(i=i.j(n)).add(u(a))}return i},a=td.Integer=i}).apply(void 0!==tc?tc:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var tf="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,tp={};(function(){var e,t,r=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof tf&&tf];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&r(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function g(e,t,r){return e.call.apply(e.bind,arguments)}function y(e,t,r){return(y=g).apply(null,arguments)}function v(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function w(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var b="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function E(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function T(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var x=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new S,e=>e.reset());class S{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let _,C=!1,A=new class{constructor(){this.h=this.g=null}add(e,t){let r=x.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},I=()=>{let e=Promise.resolve(void 0);_=()=>{e.then(N)}};function N(){let e;for(var t;e=null,A.g&&(e=A.g,A.g=A.g.next,A.g||(A.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}x.j(t),x.h<100&&(x.h++,t.next=x.g,x.g=t)}C=!1}function D(){this.u=this.u,this.C=this.C}function k(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}D.prototype.u=!1,D.prototype.dispose=function(){this.u||(this.u=!0,this.N())},D.prototype[Symbol.dispose]=function(){this.dispose()},D.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},k.prototype.h=function(){this.defaultPrevented=!0};var R=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function O(e){return/^[\s\xa0]*$/.test(e)}function L(e,t){k.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}w(L,k),L.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&L.Z.h.call(this)},L.prototype.h=function(){L.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var M="closure_listenable_"+(1e6*Math.random()|0),P=0;function V(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++P,this.da=this.fa=!1}function j(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function F(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function U(e){let t={};for(let r in e)t[r]=e[r];return t}let B="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<B.length;t++)r=B[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(j(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function G(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}z.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=G(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new V(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var K="closure_lm_"+(1e6*Math.random()|0),H={};function Q(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=o(i)?!!i.capture:!!i,l=J(e);if(l||(e[K]=l=new z(e)),(r=l.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return Y.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)R||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(X(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function W(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[M])$(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(X(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=J(t))?($(r,e),0==r.h&&(r.src=null,t[K]=null)):j(e)}}}function X(e){return e in H?H[e]:H[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new L(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&W(e),e=r.call(n,t)}return e}function J(e){return(e=e[K])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){D.call(this),this.i=new z(this),this.M=this,this.G=null}function er(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new k(t,e);else if(t instanceof k)t.target=t.target||e;else{var a=t;q(t=new k(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=en(r=t.g=i[n],s,!0,t)&&a;if(a=en(r=t.g=e,s,!0,t)&&a,a=en(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=en(r=t.g=i[n],s,!1,t)&&a}function en(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&$(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}w(et,D),et.prototype[M]=!0,et.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=o(i)?!!i.capture:!!i,n=ee(n),t&&t[M])?(t=t.i,(a=String(r).toString())in t.g&&(n=G(r=t.g[a],n,i,s))>-1&&(j(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=J(t))&&(r=t.g[r.toString()],t=-1,r&&(t=G(r,n,i,s)),(n=t>-1?r[t]:null)&&W(n))}(this,e,t,r,n)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)j(r[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},et.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ei extends D{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=y(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){D.call(this),this.h=e,this.g={}}w(es,D);var ea=[];function eo(e){F(e.g,function(e,t){this.g.hasOwnProperty(t)&&W(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),eo(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,eh=a.JSON.parse,eu=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){k.call(this,"d")}function em(){k.call(this,"c")}w(ep,k),w(em,k);var eg={},ey=null;function ev(){return ey=ey||new et}function ew(e){k.call(this,eg.Ia,e)}function eb(e){let t=ev();er(t,new ew(t))}function eE(e,t){k.call(this,eg.STAT_EVENT,e),this.stat=t}function eT(e){let t=ev();er(t,new eE(t,e))}function ex(e,t){k.call(this,eg.Ja,e),this.size=t}function eS(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function e_(){this.g=!0}function eC(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return el(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}eg.Ia="serverreachability",w(ew,k),eg.STAT_EVENT="statevent",w(eE,k),eg.Ja="timingevent",w(ex,k),e_.prototype.ua=function(){this.g=!1},e_.prototype.info=function(){};var eA={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eI={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eN(){}function eD(e){return encodeURIComponent(String(e))}function ek(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eR}function eR(){this.i=null,this.g="",this.h=!1}w(eN,ec),eN.prototype.g=function(){return new XMLHttpRequest},e=new eN;var eO={},eL={};function eM(e,t,r){e.M=1,e.A=e5(e0(t)),e.u=r,e.R=!0,eP(e,null)}function eP(e,t){e.F=Date.now(),ej(e),e.B=e0(e.A);var r,n,i,s,a,l,h=e.B,u=e.S;Array.isArray(u)||(u=[String(u)]),th(h.i,"t",u),e.C=0,h=e.j.L,e.h=new eR,e.g=tY(e.j,h?t:null,!e.u),e.P>0&&(e.O=new ei(y(e.Y,e,e.g),e.P)),t=e.V,h=e.g,u=e.ba;var c="readystatechange";Array.isArray(c)||(c&&(ea[0]=c.toString()),c=ea);for(let e=0;e<c.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[M]?t.K(r,n,o(i)?!!i.capture:!!i,s):Q(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[M]?t.J(r,n,o(i)?!!i.capture:!!i,s):Q(t,r,n,!1,i,s)}(h,c[e],u||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?U(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eb(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,l=e.u,r.info(function(){if(r.g)if(l){var e="",t=l.split("&");for(let r=0;r<t.length;r++){var o=t[r].split("=");if(o.length>1){let t=o[0];o=o[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eV(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function ej(e){e.T=Date.now()+e.H,eF(e,e.H)}function eF(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eS(y(e.aa,e),t)}function eU(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function eB(e){0==e.j.I||e.K||tK(e.j,e)}function eq(e){eU(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eQ(r.h,e))){if(!e.L&&eQ(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tG(r),tM(r);else break e;tq(r),eT(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=eS(y(r.Va,r),6e3));1>=eH(r.h)&&r.ta&&(r.ta=void 0)}else tQ(r,11)}else if((e.L||r.g==e)&&tG(r),!O(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eW(s,s.h),s.h=null))}if(n.G){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e6(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tX(n,n.L?n.ba:null,n.W),e.L){eX(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(eU(e),ej(e)),n.g=e}else tB(n);r.i.length>0&&tV(r)}else"stop"!=o[0]&&"close"!=o[0]||tQ(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tQ(r,7):tL(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}eb(4)}catch(e){}}ek.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tD(e)?t.j():this.Y(e)},ek.prototype.Y=function(e){try{if(e==this.g)e:{let f=tD(this.g),p=this.g.ya(),m=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tk(this.g)))){this.K||4!=f||7==p||(8==p||m<=0?eb(3):eb(2)),eU(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eV(e))return e.g.la();let t=tk(e.g);if(""===t)return"";let r="",n=t.length,i=4==tD(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return eq(e),eB(e),"";e.h.i=new a.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,o=this.l,l=this.S,n.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,o,l,h,u=this.g;if((h=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(h)){var c=h;break t}}c=null}if(e=c)eC(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eT(12),eq(this),eB(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eL:isNaN(r=Number(t.substring(r,n)))?eO:(n+=1)+r>t.length?eL:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eL){4==f&&(this.m=4,eT(14),e=!1),eC(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eO){this.m=4,eT(15),eC(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else eC(this.i,this.l,t,null),ez(this,t);if(eV(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=r.length||this.h.h||(this.m=1,eT(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tz(d),d.P=!0,eT(11))}}else eC(this.i,this.l,r,"[Invalid Chunked Response]"),eq(this),eB(this)}else eC(this.i,this.l,r,null),ez(this,r);4==f&&eq(this),this.o&&!this.K&&(4==f?tK(this.j,this):(this.o=!1,ej(this)))}else(function(e){let t={};e=(e.g&&tD(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(O(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,eT(12)):(this.m=0,eT(13)),eq(this),eB(this)}}}catch(e){}finally{}},ek.prototype.cancel=function(){this.K=!0,eq(this)},ek.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eb(),eT(17)),eq(this),this.m=2,eB(this)):eF(this,this.T-r)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eG(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eK(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eH(e){return e.h?1:e.g?e.g.size:0}function eQ(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eW(e,t){e.g?e.g.add(t):e.h=t}function eX(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eY(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return E(e.i)}eG.prototype.cancel=function(){if(this.i=eY(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eJ=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e3(this,tu(e.i)),this.m=e.m):e&&(t=String(e).match(eJ))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e4(t[2]||""),this.g=e4(t[3]||"",!0),e2(this,t[4]),this.h=e4(t[5]||"",!0),e3(this,t[6]||"",!0),this.m=e4(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,r){e.j=r?e4(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e3(e,t,r){var n,i;t instanceof ti?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(ts(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(ta(this,t),th(this,r,e))},n)),n.j=i):(r||(t=e8(t,tr)),e.i=new ti(t,e.l))}function e6(e,t,r){e.i.set(t,r)}function e5(e){return e6(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e4(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eD(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e8(r,"/"==r.charAt(0)?tt:te,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e8(r,tn)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),r=!!e.j;r?e1(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e2(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e3(t,tu(e.i)):r=!!e.m,r&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tr=/[#\?@]/g,tn=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function ta(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let r=[];if("string"==typeof t)to(e,t)&&(r=r.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function th(e,t,r){ta(e,t),r.length>0&&(e.i=null,e.g.set(tc(e,t),E(r)),e.h+=r.length)}function tu(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tm(){this.g=new eu}function tg(e){this.i=e.Sb||null,this.h=e.ab||!1}function ty(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tv(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function tw(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tb(e)}function tb(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tE(e){let t="";return F(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tT(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tE(r),"string"==typeof e?null!=r&&eD(r):e6(e,t,r))}function tx(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,to(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eD(r);r=tl(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eD(r[t])),e.push(n)}}return this.i=e.join("&")},w(tg,ec),tg.prototype.g=function(){return new ty(this.i,this.h)},w(ty,et),(t=ty.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tb(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,tw(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tb(this)),this.g&&(this.readyState=3,tb(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tv(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tw(this):tb(this),3==this.readyState&&tv(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,tw(this))},t.Na=function(e){this.g&&(this.response=e,tw(this))},t.ga=function(){this.g&&tw(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),w(tx,et);var tS=/^https?$/i,t_=["POST","PUT"];function tC(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tA(e),tN(e)}function tA(e){e.A||(e.A=!0,er(e,"complete"),er(e,"error"))}function tI(e){if(e.h&&void 0!==s){if(e.v&&4==tD(e))setTimeout(e.Ca.bind(e),0);else if(er(e,"readystatechange"),4==tD(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(eJ)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),r=!tS.test(t?t.toLowerCase():"")}t=r}if(t)er(e,"complete"),er(e,"success");else{e.o=6;try{var i=tD(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tA(e)}}finally{tN(e)}}}}function tN(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||er(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tD(e){return e.g?e.g.readyState:0}function tk(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tR(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tO(e){this.za=0,this.i=[],this.j=new e_,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tR("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tR("baseRetryDelayMs",5e3,e),this.Za=tR("retryDelaySeedMs",1e4,e),this.Ta=tR("forwardChannelMaxRetries",2,e),this.va=tR("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eG(e&&e.concurrentRequestLimit),this.Ba=new tm,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tL(e){if(tP(e),3==e.I){var t=e.V++,r=e0(e.J);if(e6(r,"SID",e.M),e6(r,"RID",t),e6(r,"TYPE","terminate"),tF(e,r),(t=new ek(e,e.j,t)).M=2,t.A=e5(e0(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.A,r=!0),r||(t.g=tY(t.j,null),t.g.ea(t.A)),t.F=Date.now(),ej(t)}tW(e)}function tM(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tP(e){tM(e),e.v&&(a.clearTimeout(e.v),e.v=null),tG(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tV(e){if(!eK(e.h)&&!e.m){e.m=!0;var t=e.Ea;_||I(),C||(_(),C=!0),A.add(t,e),e.D=0}}function tj(e,t){var r;r=t?t.l:e.V++;let n=e0(e.J);e6(n,"SID",e.M),e6(n,"RID",r),e6(n,"AID",e.K),tF(e,n),e.u&&e.o&&tT(n,e.u,e.o),r=new ek(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tU(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eW(e.h,r),eM(r,n,t)}function tF(e,t){e.H&&F(e.H,function(e,r){e6(t,r,e)}),e.l&&F({},function(e,r){e6(t,r,e)})}function tU(e,t,r){r=Math.min(e.i.length,r);let n=e.l?y(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let h=0;h<r;h++){var s=i[h].g;let r=i[h].map;if((s-=t)<0)t=Math.max(0,i[h].g-100),l=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;o(r)&&(n=el(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tB(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;_||I(),C||(_(),C=!0),A.add(t,e),e.A=0}}function tq(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eS(y(e.Da,e),tH(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function t$(e){e.g=new ek(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e6(t,"RID","rpc"),e6(t,"SID",e.M),e6(t,"AID",e.K),e6(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e6(t,"TO",e.ia),e6(t,"TYPE","xmlhttp"),tF(e,t),e.u&&e.o&&tT(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e5(e0(t)),r.u=null,r.R=!0,eP(r,e)}function tG(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tK(e,t){var r,n=null;if(e.g==t){tG(e),tz(e),e.g=null;var i=2}else{if(!eQ(e.h,t))return;n=t.G,eX(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;er(i=ev(),new ex(i,n)),tV(e)}else tB(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eH(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eS(y(e.Ea,e,r),tH(e,e.D)),e.D++,!0)))||2==i&&tq(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:tQ(e,5);break;case 4:tQ(e,10);break;case 3:tQ(e,6);break;default:tQ(e,2)}}}function tH(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tQ(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var r,n=y(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(i,"https"),e5(i),l?function(e,t){let r=new e_;if(a.Image){let n=new Image;n.onload=v(td,r,"TestLoadImage: loaded",!0,t,n),n.onerror=v(td,r,"TestLoadImage: error",!1,t,n),n.onabort=v(td,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=v(td,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new e_,s=new AbortController,o=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?td(t,"TestPingServer: ok",!0,n):td(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(o),td(t,"TestPingServer: error",!1,n)}))}else eT(2);e.I=0,e.l&&e.l.pa(t),tW(e),tP(e)}function tW(e){if(e.I=0,e.ja=[],e.l){let t=eY(e.h);(0!=t.length||0!=e.i.length)&&(T(e.ja,t),T(e.ja,e.i),e.h.i.length=0,E(e.i),e.i.length=0),e.l.oa()}}function tX(e,t,r){var n=r instanceof eZ?e0(r):new eZ(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e2(n,n.u);else{var i=a.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);n&&e1(e,n),t&&(e.g=t),i&&e2(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e6(n,r,t),e6(n,"VER",e.ka),tF(e,n),n}function tY(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tx(e.Aa&&!e.ma?new tg({ab:r}):e.ma)).Fa(e.L),t}function tJ(){}function tZ(){}function t0(e,t){et.call(this),this.g=new tO(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!O(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!O(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t3(this)}function t1(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){em.call(this),this.status=1}function t3(e){this.g=e}(t=tx.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=b(y(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tC(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(t_,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tC(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,er(this,"complete"),er(this,"abort"),tN(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tN(this,!0)),tx.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tI(this):this.Xa())},t.Xa=function(){tI(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tD(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eh(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tO.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){eT(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tX(this,null,this.W),tV(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new ek(this,this.j,e),s=this.o;if(this.U&&(s?q(s=U(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tU(this,i,t),e6(r=e0(this.J),"RID",e),e6(r,"CVER",22),this.G&&e6(r,"X-HTTP-Session-Id",this.G),tF(this,r),s&&(this.R?t="headers="+eD(tE(s))+"&"+t:this.u&&tT(r,this.u,s)),eW(this.h,i),this.Ra&&e6(r,"TYPE","init"),this.S?(e6(r,"$req",t),e6(r,"SID","null"),i.U=!0,eM(i,r,null)):eM(i,r,t),this.I=2}}else 3==this.I&&(e?tj(this,e):0==this.i.length||eK(this.h)||tj(this))},t.Da=function(){if(this.v=null,t$(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eS(y(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eT(10),tM(this),t$(this))},t.Va=function(){null!=this.C&&(this.C=null,tM(this),tq(this),eT(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eT(2)):(this.j.info("Failed to ping google.com"),eT(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tJ.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},w(t0,et),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tL(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=el(e),e=r);t.i.push(new e$(t.Ya++,e)),3==t.I&&tV(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tL(this.g),delete this.g,t0.Z.N.call(this)},w(t1,ep),w(t2,em),w(t3,tJ),t3.prototype.ra=function(){er(this.g,"a")},t3.prototype.qa=function(e){er(this.g,new t1(e))},t3.prototype.pa=function(e){er(this.g,new t2)},t3.prototype.oa=function(){er(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,m=tp.createWebChannelTransport=function(){return new tZ},p=tp.getStatEventTarget=function(){return ev()},f=tp.Event=eg,d=tp.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eA.NO_ERROR=0,eA.TIMEOUT=8,eA.HTTP_ERROR=6,c=tp.ErrorCode=eA,eI.COMPLETE="complete",u=tp.EventType=eI,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,h=tp.WebChannel=ed,tp.FetchXmlHttpFactory=tg,tx.prototype.listenOnce=tx.prototype.K,tx.prototype.getLastError=tx.prototype.Ha,tx.prototype.getLastErrorCode=tx.prototype.ya,tx.prototype.getStatus=tx.prototype.ca,tx.prototype.getResponseJson=tx.prototype.La,tx.prototype.getResponseText=tx.prototype.la,tx.prototype.send=tx.prototype.ea,tx.prototype.setWithCredentials=tx.prototype.Fa,l=tp.XhrIo=tx}).apply(void 0!==tf?tf:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let tm="@firebase/firestore",tg="4.9.2";class ty{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ty.UNAUTHENTICATED=new ty(null),ty.GOOGLE_CREDENTIALS=new ty("google-credentials-uid"),ty.FIRST_PARTY=new ty("first-party-uid"),ty.MOCK_USER=new ty("mock-user");let tv="12.3.0",tw=new eb("@firebase/firestore");function tb(){return tw.logLevel}function tE(e,...t){if(tw.logLevel<=s.DEBUG){let r=t.map(tS);tw.debug(`Firestore (${tv}): ${e}`,...r)}}function tT(e,...t){if(tw.logLevel<=s.ERROR){let r=t.map(tS);tw.error(`Firestore (${tv}): ${e}`,...r)}}function tx(e,...t){if(tw.logLevel<=s.WARN){let r=t.map(tS);tw.warn(`Firestore (${tv}): ${e}`,...r)}}function tS(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function t_(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,tC(e,n,r)}function tC(e,t,r){let n=`FIRESTORE (${tv}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw tT(n),Error(n)}function tA(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||tC(t,i,n)}let tI={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tN extends es{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tD{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class tk{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ty.UNAUTHENTICATED))}shutdown(){}}class tO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tL{constructor(e){this.t=e,this.currentUser=ty.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){tA(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new tD;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new tD,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{tE("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(tE("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new tD)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(tE("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tA("string"==typeof t.accessToken,31837,{l:t}),new tk(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return tA(null===e||"string"==typeof e,2055,{h:e}),new ty(e)}}class tM{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ty.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class tP{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new tM(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ty.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class tV{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tj{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,eW(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){tA(void 0===this.o,3512);let r=e=>{null!=e.error&&tE("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,tE("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{tE("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):tE("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new tV(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tA("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new tV(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class tF{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function tU(e,t){return e<t?-1:+(e>t)}function tB(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return tq(r)===tq(i)?tU(r,i):tq(r)?1:-1}return tU(e.length,t.length)}function tq(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function tz(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let t$="__name__";class tG{constructor(e,t,r){void 0===t?t=0:t>e.length&&t_(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&t_(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===tG.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof tG?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=tG.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return tU(e.length,t.length)}static compareSegments(e,t){let r=tG.isNumericId(e),n=tG.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?tG.extractNumericId(e).compare(tG.extractNumericId(t)):tB(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return a.fromString(e.substring(4,e.length-2))}}class tK extends tG{construct(e,t,r){return new tK(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new tN(tI.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new tK(t)}static emptyPath(){return new tK([])}}let tH=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tQ extends tG{construct(e,t,r){return new tQ(e,t,r)}static isValidIdentifier(e){return tH.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tQ.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===t$}static keyField(){return new tQ([t$])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new tN(tI.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new tN(tI.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new tN(tI.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new tN(tI.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tQ(t)}static emptyPath(){return new tQ([])}}class tW{constructor(e){this.path=e}static fromPath(e){return new tW(tK.fromString(e))}static fromName(e){return new tW(tK.fromString(e).popFirst(5))}static empty(){return new tW(tK.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===tK.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return tK.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new tW(new tK(e.slice()))}}function tX(e,t,r){if(!r)throw new tN(tI.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function tY(e){if(!tW.isDocumentKey(e))throw new tN(tI.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function tJ(e){if(tW.isDocumentKey(e))throw new tN(tI.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function tZ(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function t0(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":t_(12329,{type:typeof e})}function t1(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new tN(tI.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=t0(e);throw new tN(tI.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function t2(e,t){let r={typeString:e};return t&&(r.value=t),r}function t3(e,t){let r;if(!tZ(e))throw new tN(tI.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new tN(tI.INVALID_ARGUMENT,r);return!0}class t6{static now(){return t6.fromMillis(Date.now())}static fromDate(e){return t6.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new t6(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new tN(tI.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new tN(tI.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tU(this.nanoseconds,e.nanoseconds):tU(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:t6._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(t3(e,t6._jsonSchema))return new t6(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}t6._jsonSchemaVersion="firestore/timestamp/1.0",t6._jsonSchema={type:t2("string",t6._jsonSchemaVersion),seconds:t2("number"),nanoseconds:t2("number")};class t5{static fromTimestamp(e){return new t5(e)}static min(){return new t5(new t6(0,0))}static max(){return new t5(new t6(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class t4{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new t4(t5.min(),tW.empty(),-1)}static max(){return new t4(t5.max(),tW.empty(),-1)}}class t8{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function t7(e){if(e.code!==tI.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;tE("LocalStore","Unexpectedly lost primary lease")}class t9{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&t_(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new t9((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof t9?t:t9.resolve(t)}catch(e){return t9.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):t9.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):t9.reject(t)}static resolve(e){return new t9((t,r)=>{t(e)})}static reject(e){return new t9((t,r)=>{r(e)})}static waitFor(e){return new t9((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=t9.resolve(!1);for(let r of e)t=t.next(e=>e?t9.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new t9((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new t9((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}function re(e){return"IndexedDbTransactionError"===e.name}class rt{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}rt.ce=-1;function rr(e){return 0===e&&1/e==-1/0}function rn(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function ri(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function rs(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class ra{constructor(e,t){this.comparator=e,this.root=t||rl.EMPTY}insert(e,t){return new ra(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rl.BLACK,null,null))}remove(e){return new ra(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ro(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ro(this.root,e,this.comparator,!1)}getReverseIterator(){return new ro(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ro(this.root,e,this.comparator,!0)}}class ro{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class rl{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:rl.RED,this.left=null!=n?n:rl.EMPTY,this.right=null!=i?i:rl.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new rl(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return rl.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return rl.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,rl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,rl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw t_(43730,{key:this.key,value:this.value});if(this.right.isRed())throw t_(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw t_(27949);return e+ +!this.isRed()}}rl.EMPTY=null,rl.RED=!0,rl.BLACK=!1,rl.EMPTY=new class{constructor(){this.size=0}get key(){throw t_(57766)}get value(){throw t_(16141)}get color(){throw t_(16727)}get left(){throw t_(29726)}get right(){throw t_(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new rl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class rh{constructor(e){this.comparator=e,this.data=new ra(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ru(this.data.getIterator())}getIteratorFrom(e){return new ru(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof rh)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new rh(this.comparator);return t.data=e,t}}class ru{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class rc{constructor(e){this.fields=e,e.sort(tQ.comparator)}static empty(){return new rc([])}unionWith(e){let t=new rh(tQ.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new rc(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tz(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class rd extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class rf{constructor(e){this.binaryString=e}static fromBase64String(e){return new rf(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new rd("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new rf(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tU(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}rf.EMPTY_BYTE_STRING=new rf("");let rp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rm(e){if(tA(!!e,39018),"string"==typeof e){let t=0,r=rp.exec(e);if(tA(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:rg(e.seconds),nanos:rg(e.nanos)}}function rg(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ry(e){return"string"==typeof e?rf.fromBase64String(e):rf.fromUint8Array(e)}let rv="server_timestamp",rw="__type__",rb="__previous_value__",rE="__local_write_time__";function rT(e){return(e?.mapValue?.fields||{})[rw]?.stringValue===rv}function rx(e){let t=e.mapValue.fields[rb];return rT(t)?rx(t):t}function rS(e){let t=rm(e.mapValue.fields[rE].timestampValue);return new t6(t.seconds,t.nanos)}class r_{constructor(e,t,r,n,i,s,a,o,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=h}}let rC="(default)";class rA{constructor(e,t){this.projectId=e,this.database=t||rC}static empty(){return new rA("","")}get isDefaultDatabase(){return this.database===rC}isEqual(e){return e instanceof rA&&e.projectId===this.projectId&&e.database===this.database}}let rI="__type__",rN="__max__",rD={},rk="__vector__",rR="value";function rO(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?rT(e)?4:rH(e)?0x1fffffffffffff:rG(e)?10:11:t_(28295,{value:e})}function rL(e,t){if(e===t)return!0;let r=rO(e);if(r!==rO(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return rS(e).isEqual(rS(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=rm(e.timestampValue),i=rm(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return ry(e.bytesValue).isEqual(ry(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return rg(e.geoPointValue.latitude)===rg(t.geoPointValue.latitude)&&rg(e.geoPointValue.longitude)===rg(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return rg(e.integerValue)===rg(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=rg(e.doubleValue),n=rg(t.doubleValue);return r===n?rr(r)===rr(n):isNaN(r)&&isNaN(n)}return!1;case 9:return tz(e.arrayValue.values||[],t.arrayValue.values||[],rL);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(rn(s)!==rn(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!rL(s[e],a[e])))return!1;return!0;default:return t_(52216,{left:e})}}function rM(e,t){return void 0!==(e.values||[]).find(e=>rL(e,t))}function rP(e,t){var r,n,i,s,a,o;if(e===t)return 0;let l=rO(e),h=rO(t);if(l!==h)return tU(l,h);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return tU(e.booleanValue,t.booleanValue);case 2:let u,c;return u=rg(e.integerValue||e.doubleValue),u<(c=rg(t.integerValue||t.doubleValue))?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1;case 3:return rV(e.timestampValue,t.timestampValue);case 4:return rV(rS(e),rS(t));case 5:return tB(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=ry(r),f=ry(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=tU(r[e],n[e]);if(0!==t)return t}return tU(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=tU(rg(i.latitude),rg(s.latitude)))?p:tU(rg(i.longitude),rg(s.longitude));case 9:return rj(e.arrayValue,t.arrayValue);case 10:let m,g,y,v,w;return a=e.mapValue,o=t.mapValue,m=a.fields||{},g=o.fields||{},y=m[rR]?.arrayValue,v=g[rR]?.arrayValue,0!==(w=tU(y?.values?.length||0,v?.values?.length||0))?w:rj(y,v);case 11:return function(e,t){if(e===rD&&t===rD)return 0;if(e===rD)return 1;if(t===rD)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=tB(n[e],s[e]);if(0!==t)return t;let a=rP(r[n[e]],i[s[e]]);if(0!==a)return a}return tU(n.length,s.length)}(e.mapValue,t.mapValue);default:throw t_(23264,{he:l})}}function rV(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return tU(e,t);let r=rm(e),n=rm(t),i=tU(r.seconds,n.seconds);return 0!==i?i:tU(r.nanos,n.nanos)}function rj(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=rP(r[e],n[e]);if(t)return t}return tU(r.length,n.length)}function rF(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=rm(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?ry(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,tW.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=rF(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${rF(e.fields[i])}`;return r+"}"}(e.mapValue):t_(61005,{value:e})}function rU(e){return!!e&&"integerValue"in e}function rB(e){return!!e&&"arrayValue"in e}function rq(e){return!!e&&"nullValue"in e}function rz(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function r$(e){return!!e&&"mapValue"in e}function rG(e){return(e?.mapValue?.fields||{})[rI]?.stringValue===rk}function rK(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return ri(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=rK(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=rK(e.arrayValue.values[r]);return t}return{...e}}function rH(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===rN}class rQ{constructor(e){this.value=e}static empty(){return new rQ({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!r$(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rK(t)}setAll(e){let t=tQ.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=rK(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());r$(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rL(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];r$(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(ri(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new rQ(rK(this.value))}}class rW{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new rW(e,0,t5.min(),t5.min(),t5.min(),rQ.empty(),0)}static newFoundDocument(e,t,r,n){return new rW(e,1,t,t5.min(),r,n,0)}static newNoDocument(e,t){return new rW(e,2,t,t5.min(),t5.min(),rQ.empty(),0)}static newUnknownDocument(e,t){return new rW(e,3,t,t5.min(),t5.min(),rQ.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(t5.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rQ.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rQ.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=t5.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof rW&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rW(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rX{constructor(e,t){this.position=e,this.inclusive=t}}function rY(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?tW.comparator(tW.fromName(a.referenceValue),r.key):rP(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function rJ(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!rL(e.position[r],t.position[r]))return!1;return!0}class rZ{constructor(e,t="asc"){this.field=e,this.dir=t}}class r0{}class r1 extends r0{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new r5(e,t,r):"array-contains"===t?new r9(e,r):"in"===t?new ne(e,r):"not-in"===t?new nt(e,r):"array-contains-any"===t?new nr(e,r):new r1(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new r4(e,r):new r8(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(rP(t,this.value)):null!==t&&rO(this.value)===rO(t)&&this.matchesComparison(rP(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return t_(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class r2 extends r0{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new r2(e,t)}matches(e){return r3(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function r3(e){return"and"===e.op}function r6(e){for(let t of e.filters)if(t instanceof r2)return!1;return!0}class r5 extends r1{constructor(e,t,r){super(e,t,r),this.key=tW.fromName(r.referenceValue)}matches(e){let t=tW.comparator(e.key,this.key);return this.matchesComparison(t)}}class r4 extends r1{constructor(e,t){super(e,"in",t),this.keys=r7("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class r8 extends r1{constructor(e,t){super(e,"not-in",t),this.keys=r7("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function r7(e,t){return(t.arrayValue?.values||[]).map(e=>tW.fromName(e.referenceValue))}class r9 extends r1{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return rB(t)&&rM(t.arrayValue,this.value)}}class ne extends r1{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&rM(this.value.arrayValue,t)}}class nt extends r1{constructor(e,t){super(e,"not-in",t)}matches(e){if(rM(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!rM(this.value.arrayValue,t)}}class nr extends r1{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!rB(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>rM(this.value.arrayValue,e))}}class nn{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function ni(e,t=null,r=[],n=[],i=null,s=null,a=null){return new nn(e,t,r,n,i,s,a)}function ns(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof r1)return t.field.canonicalString()+t.op.toString()+rF(t.value);if(r6(t)&&r3(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>rF(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>rF(e)).join(",")),e.Te=t}return e.Te}function na(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof r1?r instanceof r1&&t.op===r.op&&t.field.isEqual(r.field)&&rL(t.value,r.value):t instanceof r2?r instanceof r2&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void t_(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rJ(e.startAt,t.startAt)&&rJ(e.endAt,t.endAt)}function no(e){return tW.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class nl{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function nh(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function nu(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new rh(tQ.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new rZ(t,n))}),r.has(tQ.keyField().canonicalString())||e.Ie.push(new rZ(tQ.keyField(),n))}return e.Ie}function nc(e){return e.Ee||(e.Ee=function(e,t){if("F"===e.limitType)return ni(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new rZ(e.field,t)});let r=e.endAt?new rX(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new rX(e.startAt.position,e.startAt.inclusive):null;return ni(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}(e,nu(e))),e.Ee}function nd(e,t,r){return new nl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function nf(e,t){return na(nc(e),nc(t))&&e.limitType===t.limitType}function np(e){return`${ns(nc(e))}|lt:${e.limitType}`}function nm(e){var t;let r;return`Query(target=${r=(t=nc(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof r1?`${t.field.canonicalString()} ${t.op} ${rF(t.value)}`:t instanceof r2?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>rF(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>rF(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function ng(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):tW.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of nu(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=rY(i,nu(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=rY(s,nu(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function ny(e){return(t,r)=>{let n=!1;for(let i of nu(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?tW.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?rP(i,s):t_(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return t_(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class nv{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){ri(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return rs(this.inner)}size(){return this.innerSize}}let nw=new ra(tW.comparator),nb=new ra(tW.comparator);function nE(...e){let t=nb;for(let r of e)t=t.insert(r.key,r);return t}function nT(e){let t=nb;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function nx(){return new nv(e=>e.toString(),(e,t)=>e.isEqual(t))}let nS=new ra(tW.comparator),n_=new rh(tW.comparator);function nC(...e){let t=n_;for(let r of e)t=t.add(r);return t}let nA=new rh(tU);function nI(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rr(t)?"-0":t}}function nN(e){return{integerValue:""+e}}class nD{constructor(){this._=void 0}}function nk(e,t){return e instanceof nV?rU(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class nR extends nD{}class nO extends nD{constructor(e){super(),this.elements=e}}function nL(e,t){let r=nF(t);for(let t of e.elements)r.some(e=>rL(e,t))||r.push(t);return{arrayValue:{values:r}}}class nM extends nD{constructor(e){super(),this.elements=e}}function nP(e,t){let r=nF(t);for(let t of e.elements)r=r.filter(e=>!rL(e,t));return{arrayValue:{values:r}}}class nV extends nD{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function nj(e){return rg(e.integerValue||e.doubleValue)}function nF(e){return rB(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class nU{constructor(e,t){this.field=e,this.transform=t}}class nB{constructor(e,t){this.version=e,this.transformResults=t}}class nq{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new nq}static exists(e){return new nq(void 0,e)}static updateTime(e){return new nq(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function nz(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class n${}function nG(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new nZ(e.key,nq.none()):new nQ(e.key,e.data,nq.none());{let r=e.data,n=rQ.empty(),i=new rh(tQ.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new nW(e.key,n,new rc(i.toArray()),nq.none())}}function nK(e,t,r,n){return e instanceof nQ?function(e,t,r,n){if(!nz(e.precondition,t))return r;let i=e.value.clone(),s=nJ(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof nW?function(e,t,r,n){if(!nz(e.precondition,t))return r;let i=nJ(e.fieldTransforms,n,t),s=t.data;return(s.setAll(nX(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):nz(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function nH(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&tz(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof nO&&n instanceof nO||r instanceof nM&&n instanceof nM?tz(r.elements,n.elements,rL):r instanceof nV&&n instanceof nV?rL(r.Ae,n.Ae):r instanceof nR&&n instanceof nR)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class nQ extends n${constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class nW extends n${constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function nX(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function nY(e,t,r){let n=new Map;tA(e.length===r.length,32656,{Re:r.length,Ve:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof nO?nL(o,l):o instanceof nM?nP(o,l):i))}return n}function nJ(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof nR?(n=t,i={fields:{[rw]:{stringValue:rv},[rE]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&rT(n)&&(n=rx(n)),n&&(i.fields[rb]=n),{mapValue:i}):e instanceof nO?nL(e,t):e instanceof nM?nP(e,t):(a=nj(s=nk(e,t))+nj(e.Ae),rU(s)&&rU(e.Ae)?nN(a):nI(e.serializer,a))}(e,s,t))}return n}class nZ extends n${constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class n0 extends n${constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class n1{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof nQ?(n=e.value.clone(),i=nY(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof nW?function(e,t,r){if(!nz(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=nY(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(nX(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=nK(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=nK(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=nx();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=nG(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(t5.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),nC())}isEqual(e){return this.batchId===e.batchId&&tz(this.mutations,e.mutations,(e,t)=>nH(e,t))&&tz(this.baseMutations,e.baseMutations,(e,t)=>nH(e,t))}}class n2{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){tA(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=nS,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new n2(e,t,r,n)}}class n3{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class n6{constructor(e,t){this.count=e,this.unchangedNames=t}}function n5(e){if(void 0===e)return tT("GRPC error has no .code"),tI.UNKNOWN;switch(e){case g.OK:return tI.OK;case g.CANCELLED:return tI.CANCELLED;case g.UNKNOWN:return tI.UNKNOWN;case g.DEADLINE_EXCEEDED:return tI.DEADLINE_EXCEEDED;case g.RESOURCE_EXHAUSTED:return tI.RESOURCE_EXHAUSTED;case g.INTERNAL:return tI.INTERNAL;case g.UNAVAILABLE:return tI.UNAVAILABLE;case g.UNAUTHENTICATED:return tI.UNAUTHENTICATED;case g.INVALID_ARGUMENT:return tI.INVALID_ARGUMENT;case g.NOT_FOUND:return tI.NOT_FOUND;case g.ALREADY_EXISTS:return tI.ALREADY_EXISTS;case g.PERMISSION_DENIED:return tI.PERMISSION_DENIED;case g.FAILED_PRECONDITION:return tI.FAILED_PRECONDITION;case g.ABORTED:return tI.ABORTED;case g.OUT_OF_RANGE:return tI.OUT_OF_RANGE;case g.UNIMPLEMENTED:return tI.UNIMPLEMENTED;case g.DATA_LOSS:return tI.DATA_LOSS;default:return t_(39323,{code:e})}}(y=g||(g={}))[y.OK=0]="OK",y[y.CANCELLED=1]="CANCELLED",y[y.UNKNOWN=2]="UNKNOWN",y[y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",y[y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",y[y.NOT_FOUND=5]="NOT_FOUND",y[y.ALREADY_EXISTS=6]="ALREADY_EXISTS",y[y.PERMISSION_DENIED=7]="PERMISSION_DENIED",y[y.UNAUTHENTICATED=16]="UNAUTHENTICATED",y[y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",y[y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",y[y.ABORTED=10]="ABORTED",y[y.OUT_OF_RANGE=11]="OUT_OF_RANGE",y[y.UNIMPLEMENTED=12]="UNIMPLEMENTED",y[y.INTERNAL=13]="INTERNAL",y[y.UNAVAILABLE=14]="UNAVAILABLE",y[y.DATA_LOSS=15]="DATA_LOSS";let n4=new a([0xffffffff,0xffffffff],0);function n8(e){let t=(new TextEncoder).encode(e),r=new o;return r.update(t),new Uint8Array(r.digest())}function n7(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new a([r,n],0),new a([i,s],0)]}class n9{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ie(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new ie(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new ie(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=a.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(a.fromNumber(r)));return 1===n.compare(n4)&&(n=new a([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=n7(n8(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new n9(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=n7(n8(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.Se(n)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ie extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class it{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,ir.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new it(t5.min(),n,new ra(tU),nw,nC())}}class ir{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ir(r,t,nC(),nC(),nC())}}class ii{constructor(e,t,r,n){this.be=e,this.removedTargetIds=t,this.key=r,this.De=n}}class is{constructor(e,t){this.targetId=e,this.Ce=t}}class ia{constructor(e,t,r=rf.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class io{constructor(){this.ve=0,this.Fe=iu(),this.Me=rf.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=nC(),t=nC(),r=nC();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:t_(38017,{changeType:i})}}),new ir(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=iu()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,tA(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class il{constructor(e){this.Ge=e,this.ze=new Map,this.je=nw,this.Je=ih(),this.He=ih(),this.Ye=new ra(tU)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:t_(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let i=n.target;if(no(i))if(0===r){let e=new tW(i.path);this.et(t,e,rW.newNoDocument(e,t5.min()))}else tA(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){let r=this.ut(e),i=r?this.ct(r,e,n):1;0!==i&&(this.it(t),this.Ye=this.Ye.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=ry(i).toUint8Array()}catch(e){if(e instanceof rd)return tx("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new n9(t,s,a)}catch(e){return tx(e instanceof ie?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&no(i.target)){let t=new tW(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,rW.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.qe())}});let r=nC();this.He.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new it(e,t,this.Ye,this.je,r);return this.je=nw,this.Je=ih(),this.He=ih(),this.Ye=new ra(tU),n}Xe(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.Qe(t,1):n.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new io,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new rh(tU),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new rh(tU),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||tE("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new io),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ih(){return new ra(tW.comparator)}function iu(){return new ra(tW.comparator)}let ic={asc:"ASCENDING",desc:"DESCENDING"},id={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ip={and:"AND",or:"OR"};class im{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ig(e,t){return e.useProto3Json||null==t?t:{value:t}}function iy(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iv(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function iw(e){let t;return tA(!!e,49232),t5.fromTimestamp(new t6((t=rm(e)).seconds,t.nanos))}function ib(e,t){return iE(e,t).canonicalString()}function iE(e,t){let r=new tK(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function iT(e){let t=tK.fromString(e);return tA(ik(t),10190,{key:t.toString()}),t}function ix(e,t){return ib(e.databaseId,t.path)}function iS(e,t){let r=iT(t);if(r.get(1)!==e.databaseId.projectId)throw new tN(tI.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new tN(tI.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new tW(iA(r))}function i_(e,t){return ib(e.databaseId,t)}function iC(e){return new tK(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function iA(e){return tA(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function iI(e,t,r){return{name:ix(e,t),fields:r.value.mapValue.fields}}function iN(e){return{fieldPath:e.canonicalString()}}function iD(e){return tQ.fromServerFormat(e.fieldPath)}function ik(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class iR{constructor(e,t,r,n,i=t5.min(),s=t5.min(),a=rf.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new iR(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iR(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iR(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iR(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iO{constructor(e){this.yt=e}}class iL{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(rg(e.integerValue));else if("doubleValue"in e){let r=rg(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),rr(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=rm(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(ry(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?rH(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):rG(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):t_(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[rR].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(rg(n)),this.Ot(rR,t),this.Ct(r[rR],t)}Qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),tW.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}iL.Kt=new iL;class iM{constructor(){this.Cn=new iP}addToCollectionParentIndex(e,t){return this.Cn.add(t),t9.resolve()}getCollectionParents(e,t){return t9.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return t9.resolve()}deleteFieldIndex(e,t){return t9.resolve()}deleteAllFieldIndexes(e){return t9.resolve()}createTargetIndexes(e,t){return t9.resolve()}getDocumentsMatchingTarget(e,t){return t9.resolve(null)}getIndexType(e,t){return t9.resolve(0)}getFieldIndexes(e,t){return t9.resolve([])}getNextCollectionGroupToUpdate(e){return t9.resolve(null)}getMinOffset(e,t){return t9.resolve(t4.min())}getMinOffsetFromCollectionGroup(e,t){return t9.resolve(t4.min())}updateCollectionGroup(e,t,r){return t9.resolve()}updateIndexEntries(e,t){return t9.resolve()}}class iP{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new rh(tK.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new rh(tK.comparator)).toArray()}}new Uint8Array(0);let iV={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ij{static withCacheSize(e){return new ij(e,ij.DEFAULT_COLLECTION_PERCENTILE,ij.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}ij.DEFAULT_COLLECTION_PERCENTILE=10,ij.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ij.DEFAULT=new ij(0x2800000,ij.DEFAULT_COLLECTION_PERCENTILE,ij.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ij.DISABLED=new ij(-1,0,0);class iF{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new iF(0)}static cr(){return new iF(-1)}}let iU="LruGarbageCollector";function iB([e,t],[r,n]){let i=tU(e,r);return 0===i?tU(t,n):i}class iq{constructor(e){this.Ir=e,this.buffer=new rh(iB),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>iB(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class iz{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){tE(iU,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){re(e)?tE(iU,"Ignoring IndexedDB error during garbage collection: ",e):await t7(e)}await this.Vr(3e5)})}}class i${constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return t9.resolve(rt.ce);let r=new iq(t);return this.mr.forEachTarget(e,e=>r.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>r.Ar(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(tE("LruGarbageCollector","Garbage collection skipped; disabled"),t9.resolve(iV)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(tE("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),iV):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,n,i,a,o,l,h,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tE("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,a=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(h=Date.now(),tb()<=s.DEBUG&&tE("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${n} in `+(o-a)+"ms\n"+`	Removed ${i} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(h-l)+"ms\n"+`Total Duration: ${h-u}ms`),t9.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class iG{constructor(){this.changes=new nv(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rW.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?t9.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class iK{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class iH{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&nK(r.mutation,e,rc.empty(),t6.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,nC()).next(()=>t))}getLocalViewOfDocuments(e,t,r=nC()){let n=nx();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=nE();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=nx();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,nC()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=nw,s=nx(),a=nx();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof nW)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),nK(a.mutation,t,a.mutation.getFieldMask(),t6.now())):s.set(t.key,rc.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new iK(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=nx(),n=new ra((e,t)=>e-t),i=nC();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||rc.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||nC()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,h=nx();l.forEach(e=>{if(!i.has(e)){let n=nG(t.get(e),r.get(e));null!==n&&h.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,h))}return t9.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return tW.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):null!==t.collectionGroup?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):t9.resolve(nx()),a=-1,o=i;return s.next(t=>t9.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?t9.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,nC())).next(e=>({batchId:a,changes:nT(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new tW(t)).next(e=>{let t=nE();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=nE();return this.indexManager.getCollectionParents(e,i).next(a=>t9.forEach(a,a=>{let o=new nl(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,rW.newInvalidDocument(n)))});let r=nE();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&nK(s.mutation,n,rc.empty(),t6.now()),ng(t,n)&&(r=r.insert(e,n))}),r})}}class iQ{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return t9.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:iw(t.createTime)}),t9.resolve()}getNamedQuery(e,t){return t9.resolve(this.kr.get(t))}saveNamedQuery(e,t){var r;let n;return this.kr.set(t.name,{name:t.name,query:(n=function(e){var t,r,n,i;let s,a,o,l,h,u=4===(s=iT(e.parent)).length?tK.emptyPath():iA(s),c=e.structuredQuery,d=c.from?c.from.length:0,f=null;if(d>0){tA(1===d,65062);let e=c.from[0];e.allDescendants?f=e.collectionId:u=u.child(e.collectionId)}let p=[];c.where&&(p=(a=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=iD(e.unaryFilter.field);return r1.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=iD(e.unaryFilter.field);return r1.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=iD(e.unaryFilter.field);return r1.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=iD(e.unaryFilter.field);return r1.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return t_(61313);default:return t_(60726)}}(t):void 0!==t.fieldFilter?r1.create(iD(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return t_(58110);default:return t_(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?r2.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return t_(1026)}}(t.compositeFilter.op)):t_(30097,{filter:t})}(c.where))instanceof r2&&r6(t=a)&&r3(t)?a.getFilters():[a]);let m=[];c.orderBy&&(m=c.orderBy.map(e=>new rZ(iD(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;c.limit&&(g=null==(o="object"==typeof(r=c.limit)?r.value:r)?null:o);let y=null;c.startAt&&(l=!!(n=c.startAt).before,y=new rX(n.values||[],l));let v=null;return c.endAt&&(h=!(i=c.endAt).before,v=new rX(i.values||[],h)),new nl(u,f,m,p,g,"F",y,v)}({parent:(r=t.bundledQuery).parent,structuredQuery:r.structuredQuery}),"LAST"===r.limitType?nd(n,n.limit,"L"):n),readTime:iw(t.readTime)}),t9.resolve()}}class iW{constructor(){this.overlays=new ra(tW.comparator),this.qr=new Map}getOverlay(e,t){return t9.resolve(this.overlays.get(t))}getOverlays(e,t){let r=nx();return t9.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.St(e,t,n)}),t9.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.qr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(r)),t9.resolve()}getOverlaysForCollection(e,t,r){let n=nx(),i=t.length+1,s=new tW(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return t9.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new ra((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=nx(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=nx(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return t9.resolve(a)}St(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.qr.get(n.largestBatchId).delete(r.key);this.qr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new n3(t,r));let i=this.qr.get(t);void 0===i&&(i=nC(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class iX{constructor(){this.sessionToken=rf.EMPTY_BYTE_STRING}getSessionToken(e){return t9.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,t9.resolve()}}class iY{constructor(){this.Qr=new rh(iJ.$r),this.Ur=new rh(iJ.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let r=new iJ(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new iJ(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new tW(new tK([])),r=new iJ(t,e),n=new iJ(t,e+1),i=[];return this.Ur.forEachInRange([r,n],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new tW(new tK([])),r=new iJ(t,e),n=new iJ(t,e+1),i=nC();return this.Ur.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new iJ(e,0),r=this.Qr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class iJ{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return tW.comparator(e.key,t.key)||tU(e.Yr,t.Yr)}static Kr(e,t){return tU(e.Yr,t.Yr)||tW.comparator(e.key,t.key)}}class iZ{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new rh(iJ.$r)}checkEmpty(e){return t9.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new n1(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Zr=this.Zr.add(new iJ(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return t9.resolve(s)}lookupMutationBatch(e,t){return t9.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.ei(t+1),n=r<0?0:r;return t9.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return t9.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return t9.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new iJ(t,0),n=new iJ(t,1/0),i=[];return this.Zr.forEachInRange([r,n],e=>{let t=this.Xr(e.Yr);i.push(t)}),t9.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new rh(tU);return t.forEach(e=>{let t=new iJ(e,0),n=new iJ(e,1/0);this.Zr.forEachInRange([t,n],e=>{r=r.add(e.Yr)})}),t9.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;tW.isDocumentKey(i)||(i=i.child(""));let s=new iJ(new tW(i),0),a=new rh(tU);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Yr)),!0)},s),t9.resolve(this.ti(a))}ti(e){let t=[];return e.forEach(e=>{let r=this.Xr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){tA(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Zr;return t9.forEach(t.mutations,n=>{let i=new iJ(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){let r=new iJ(t,0),n=this.Zr.firstAfterOrEqual(r);return t9.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,t9.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class i0{constructor(e){this.ri=e,this.docs=new ra(tW.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return t9.resolve(r?r.document.mutableCopy():rW.newInvalidDocument(t))}getEntries(e,t){let r=nw;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():rW.newInvalidDocument(e))}),t9.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=nw,s=t.path,a=new tW(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=tW.comparator(e.documentKey,t.documentKey))?r:tU(e.largestBatchId,t.largestBatchId)}(new t4(a.readTime,a.key,-1),r)||(n.has(a.key)||ng(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return t9.resolve(i)}getAllFromCollectionGroup(e,t,r,n){t_(9500)}ii(e,t){return t9.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new i1(this)}getSize(e){return t9.resolve(this.size)}}class i1 extends iG{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Nr.addEntry(e,n)):this.Nr.removeEntry(r)}),t9.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class i2{constructor(e){this.persistence=e,this.si=new nv(e=>ns(e),na),this.lastRemoteSnapshotVersion=t5.min(),this.highestTargetId=0,this.oi=0,this._i=new iY,this.targetCount=0,this.ai=iF.ur()}forEachTarget(e,t){return this.si.forEach((e,r)=>t(r)),t9.resolve()}getLastRemoteSnapshotVersion(e){return t9.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return t9.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),t9.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),t9.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new iF(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,t9.resolve()}updateTargetData(e,t){return this.Pr(t),t9.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,t9.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.si.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),t9.waitFor(i).next(()=>n)}getTargetCount(e){return t9.resolve(this.targetCount)}getTargetData(e,t){let r=this.si.get(t)||null;return t9.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),t9.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),t9.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),t9.resolve()}getMatchingKeysForTargetId(e,t){let r=this._i.Hr(t);return t9.resolve(r)}containsKey(e,t){return t9.resolve(this._i.containsKey(t))}}class i3{constructor(e,t){this.ui={},this.overlays={},this.ci=new rt(0),this.li=!1,this.li=!0,this.hi=new iX,this.referenceDelegate=e(this),this.Pi=new i2(this),this.indexManager=new iM,this.remoteDocumentCache=new i0(e=>this.referenceDelegate.Ti(e)),this.serializer=new iO(t),this.Ii=new iQ(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new iW,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new iZ(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){tE("MemoryPersistence","Starting transaction:",e);let n=new i6(this.ci.next());return this.referenceDelegate.Ei(),r(n).next(e=>this.referenceDelegate.di(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ai(e,t){return t9.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class i6 extends t8{constructor(e){super(),this.currentSequenceNumber=e}}class i5{constructor(e){this.persistence=e,this.Ri=new iY,this.Vi=null}static mi(e){return new i5(e)}get fi(){if(this.Vi)return this.Vi;throw t_(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),t9.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),t9.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),t9.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return t9.forEach(this.fi,r=>{let n=tW.fromPath(r);return this.gi(e,n).next(e=>{e||t.removeEntry(n,t5.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return t9.or([()=>t9.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class i4{constructor(e,t){this.persistence=e,this.pi=new nv(e=>(function(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new i$(this,t)}static mi(e,t){return new i4(e,t)}Ei(){}di(e){return t9.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return t9.forEach(this.pi,(r,n)=>this.br(e,r,n).next(e=>e?t9.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ii(e,n=>this.br(e,n,t).next(e=>{e||(r++,i.removeEntry(n,t5.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),t9.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),t9.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),t9.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),t9.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(rO(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=rx(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return ry(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,ri(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw t_(13486,{value:t})}}(e.data.value)),t}br(e,t,r){return t9.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return t9.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class i8{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=n}static As(e,t){let r=nC(),n=nC();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new i8(e,t.fromCache,r,n)}}class i7{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class i9{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){let t;return!function(){let t=Y()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Number((t=("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"").match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1")>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new i7;return this.Ss(e,t,r).next(n=>{if(i.result=n,this.Vs)return this.bs(e,t,r,n.size)})}).next(()=>i.result)}bs(e,t,r,n){return r.documentReadCount<this.fs?(tb()<=s.DEBUG&&tE("QueryEngine","SDK will not create cache indexes for query:",nm(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),t9.resolve()):(tb()<=s.DEBUG&&tE("QueryEngine","Query:",nm(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.gs*n?(tb()<=s.DEBUG&&tE("QueryEngine","The SDK decides to create cache indexes for query:",nm(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,nc(t))):t9.resolve())}ys(e,t){if(nh(t))return t9.resolve(null);let r=nc(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=nc(t=nd(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=nC(...n);return this.ps.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.Ds(t,n);return this.Cs(t,s,i,r.readTime)?this.ys(e,nd(t,null,"F")):this.vs(e,s,t,r)}))})))}ws(e,t,r,n){return nh(t)||n.isEqual(t5.min())?t9.resolve(null):this.ps.getDocuments(e,r).next(i=>{let a,o,l=this.Ds(t,i);return this.Cs(t,l,r,n)?t9.resolve(null):(tb()<=s.DEBUG&&tE("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),nm(t)),this.vs(e,l,t,(a=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,new t4(t5.fromTimestamp(1e9===o?new t6(a+1,0):new t6(a,o)),tW.empty(),-1))).next(e=>e))})}Ds(e,t){let r=new rh(ny(e));return t.forEach((t,n)=>{ng(e,n)&&(r=r.add(n))}),r}Cs(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}Ss(e,t,r){return tb()<=s.DEBUG&&tE("QueryEngine","Using full collection scan to execute query:",nm(t)),this.ps.getDocumentsMatchingQuery(e,t,t4.min(),r)}vs(e,t,r,n){return this.ps.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let se="LocalStore";class st{constructor(e,t,r,n){this.persistence=e,this.Fs=t,this.serializer=n,this.Ms=new ra(tU),this.xs=new nv(e=>ns(e),na),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new iH(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function sr(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=nC();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function sn(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}async function si(e,t,r){let n=e.Ms.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!re(e))throw e;tE(se,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(n.target)}function ss(e,t,r){let n=t5.min(),i=nC();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=nc(t),void 0!==(o=e.xs.get(a))?t9.resolve(e.Ms.get(o)):e.Pi.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,r?n:t5.min(),r?i:nC())).next(r=>{var n,s,a;let o;return n=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),a=r,o=n.Os.get(s)||t5.min(),a.forEach((e,t)=>{t.readTime.compareTo(o)>0&&(o=t.readTime)}),n.Os.set(s,o),{documents:r,Qs:i}})})}class sa{constructor(){this.activeTargetIds=nA}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class so{constructor(){this.Mo=new sa,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new sa,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class sl{Oo(e){}shutdown(){}}let sh="ConnectivityMonitor";class su{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(tE(sh,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(tE(sh,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let sc=null;function sd(){return null===sc?sc=0x10000000+Math.round(0x80000000*Math.random()):sc++,"0x"+sc.toString(16)}let sf="RestConnection",sp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class sm{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${n}`,this.Wo=this.databaseId.database===rC?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Go(e,t,r,n,i){let s=sd(),a=this.zo(e,t.toUriEncodedString());tE(sf,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,n,i);let{host:l}=new URL(a),h=ee(l);return this.Jo(e,a,o,r,h).then(t=>(tE(sf,`Received RPC '${e}' ${s}: `,t),t),t=>{throw tx(sf,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}Ho(e,t,r,n,i,s){return this.Go(e,t,r,n,i)}jo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+tv,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}zo(e,t){let r=sp[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class sg{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}let sy="WebChannelConnection";class sv extends sm{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,n,i){let s=sd();return new Promise((i,a)=>{let o=new l;o.setWithCredentials(!0),o.listenOnce(u.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case c.NO_ERROR:let t=o.getResponseJson();tE(sy,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case c.TIMEOUT:tE(sy,`RPC '${e}' ${s} timed out`),a(new tN(tI.DEADLINE_EXCEEDED,"Request time out"));break;case c.HTTP_ERROR:let r=o.getStatus();if(tE(sy,`RPC '${e}' ${s} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(tI).indexOf(e)>=0?e:tI.UNKNOWN);a(new tN(r,t.message))}else a(new tN(tI.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new tN(tI.UNAVAILABLE,"Connection failed."));break;default:t_(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{tE(sy,`RPC '${e}' ${s} completed.`)}});let h=JSON.stringify(n);tE(sy,`RPC '${e}' ${s} sending request:`,n),o.send(t,"POST",h,r,15)})}T_(e,t,r){let n=sd(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=m(),a=p(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,r),o.encodeInitMessageHeaders=!0;let u=i.join("");tE(sy,`Creating RPC '${e}' stream ${n}: ${u}`,o);let c=s.createWebChannel(u,o);this.I_(c);let y=!1,v=!1,w=new sg({Yo:t=>{v?tE(sy,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(y||(tE(sy,`Opening RPC '${e}' stream ${n} transport.`),c.open(),y=!0),tE(sy,`RPC '${e}' stream ${n} sending:`,t),c.send(t))},Zo:()=>c.close()}),b=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(c,h.EventType.OPEN,()=>{v||(tE(sy,`RPC '${e}' stream ${n} transport opened.`),w.o_())}),b(c,h.EventType.CLOSE,()=>{v||(v=!0,tE(sy,`RPC '${e}' stream ${n} transport closed`),w.a_(),this.E_(c))}),b(c,h.EventType.ERROR,t=>{v||(v=!0,tx(sy,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),w.a_(new tN(tI.UNAVAILABLE,"The operation could not be completed")))}),b(c,h.EventType.MESSAGE,t=>{if(!v){let r=t.data[0];tA(!!r,16349);let i=r?.error||r[0]?.error;if(i){tE(sy,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=g[e];if(void 0!==t)return n5(t)}(t),s=i.message;void 0===r&&(r=tI.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),v=!0,w.a_(new tN(r,s)),c.close()}else tE(sy,`RPC '${e}' stream ${n} received:`,r),w.u_(r)}}),b(a,f.STAT_EVENT,t=>{t.stat===d.PROXY?tE(sy,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===d.NOPROXY&&tE(sy,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{w.__()},0),w}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function sw(){return"undefined"!=typeof document?document:null}function sb(e){return new im(e,!0)}class sE{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=n,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&tE("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}let sT="PersistentStream";class sx{constructor(e,t,r,n,i,s,a,o){this.Mi=e,this.S_=r,this.b_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new sE(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===tI.RESOURCE_EXHAUSTED?(tT(t.toString()),tT("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===tI.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new tN(tI.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return tE(sT,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(tE(sT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sS extends sx{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:t_(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(tA(void 0===i||"string"==typeof i,58123),rf.fromBase64String(i||"")):(tA(void 0===i||i instanceof tu.Buffer||i instanceof Uint8Array,16193),rf.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new ia(s,a,o,l&&new tN(void 0===l.code?tI.UNKNOWN:n5(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=iS(e,n.document.name),s=iw(n.document.updateTime),a=n.document.createTime?iw(n.document.createTime):t5.min(),o=new rQ({mapValue:{fields:n.document.fields}}),l=rW.newFoundDocument(i,s,a,o);r=new ii(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=iS(e,n.document),s=n.readTime?iw(n.readTime):t5.min(),a=rW.newNoDocument(i,s);r=new ii([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=iS(e,n.document);r=new ii([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return t_(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new n6(n,i);r=new is(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return t5.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?t5.min():t.readTime?iw(t.readTime):t5.min()}(e);return this.listener.H_(t,r)}Y_(e){let t,r={};r.database=iC(this.serializer),r.addTarget=function(e,t){var r,n;let i,s,a,o,l,h,u,c=t.target;if((i=no(c)?{documents:{documents:[i_(e,c.path)]}}:{query:(a={structuredQuery:{}},o=c.path,null!==c.collectionGroup?(s=o,a.structuredQuery.from=[{collectionId:c.collectionGroup,allDescendants:!0}]):(s=o.popLast(),a.structuredQuery.from=[{collectionId:o.lastSegment()}]),a.parent=i_(e,s),(l=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof r1?function(e){if("=="===e.op){if(rz(e.value))return{unaryFilter:{field:iN(e.field),op:"IS_NAN"}};if(rq(e.value))return{unaryFilter:{field:iN(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(rz(e.value))return{unaryFilter:{field:iN(e.field),op:"IS_NOT_NAN"}};if(rq(e.value))return{unaryFilter:{field:iN(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:iN(e.field),op:id[e.op],value:e.value}}}(t):t instanceof r2?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:ip[r.op],filters:n}}:t_(54877,{filter:t})}(r2.create(e,"and"))}(c.filters))&&(a.structuredQuery.where=l),(h=function(e){if(0!==e.length)return e.map(e=>({field:iN(e.field),direction:ic[e.dir]}))}(c.orderBy))&&(a.structuredQuery.orderBy=h),null!==(u=ig(e,c.limit))&&(a.structuredQuery.limit=u),c.startAt&&(a.structuredQuery.startAt={before:(r=c.startAt).inclusive,values:r.position}),c.endAt&&(a.structuredQuery.endAt={before:!(n=c.endAt).inclusive,values:n.position}),{ft:a,parent:s}).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){i.resumeToken=iv(e,t.resumeToken);let r=ig(e,t.expectedCount);null!==r&&(i.expectedCount=r)}else if(t.snapshotVersion.compareTo(t5.min())>0){i.readTime=iy(e,t.snapshotVersion.toTimestamp());let r=ig(e,t.expectedCount);null!==r&&(i.expectedCount=r)}return i}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return t_(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.q_(r)}Z_(e){let t={};t.database=iC(this.serializer),t.removeTarget=e,this.q_(t)}}class s_ extends sx{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return tA(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tA(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;tA(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(tA(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?iw(e.updateTime):iw(r)).isEqual(t5.min())&&(t=iw(r)),new nB(t,e.transformResults||[])})):[]),i=iw(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=iC(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var r,n;let i;if(t instanceof nQ)i={update:iI(e,t.key,t.value)};else if(t instanceof nZ)i={delete:ix(e,t.key)};else if(t instanceof nW){let r;i={update:iI(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof n0))return t_(16599,{Vt:t.type});i={verify:ix(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof nR)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof nO)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof nM)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof nV)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw t_(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:iy(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:t_(27497)),i})(this.serializer,e))};this.q_(t)}}class sC{}class sA extends sC{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new tN(tI.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Go(e,iE(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tI.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tN(tI.UNKNOWN,e.toString())})}Ho(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Ho(e,iE(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tI.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tN(tI.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class sI{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(tT(t),this.aa=!1):tE("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let sN="RemoteStore";class sD{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{r.enqueueAndForget(async()=>{sF(this)&&(tE(sN,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await sR(e),e.Ra.set("Unknown"),e.Ea.delete(4),await sk(e)}(this))})}),this.Ra=new sI(r,n)}}async function sk(e){if(sF(e))for(let t of e.da)await t(!0)}async function sR(e){for(let t of e.da)await t(!1)}function sO(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),sj(e)?sV(e):s1(e).O_()&&sM(e,t))}function sL(e,t){let r=s1(e);e.Ia.delete(t),r.O_()&&sP(e,t),0===e.Ia.size&&(r.O_()?r.L_():sF(e)&&e.Ra.set("Unknown"))}function sM(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(t5.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}s1(e).Y_(t)}function sP(e,t){e.Va.Ue(t),s1(e).Z_(t)}function sV(e){e.Va=new il({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),s1(e).start(),e.Ra.ua()}function sj(e){return sF(e)&&!s1(e).x_()&&e.Ia.size>0}function sF(e){return 0===e.Ea.size}async function sU(e){e.Ra.set("Online")}async function sB(e){e.Ia.forEach((t,r)=>{sM(e,t)})}async function sq(e,t){e.Va=void 0,sj(e)?(e.Ra.ha(t),sV(e)):e.Ra.set("Unknown")}async function sz(e,t,r){if(e.Ra.set("Online"),t instanceof ia&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.Va.removeTarget(n))}(e,t)}catch(r){tE(sN,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await s$(e,r)}else if(t instanceof ii?e.Va.Ze(t):t instanceof is?e.Va.st(t):e.Va.tt(t),!r.isEqual(t5.min()))try{let t,n=await sn(e.localStore);r.compareTo(n)>=0&&await ((t=e.Va.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(rf.EMPTY_BYTE_STRING,n.snapshotVersion)),sP(e,t);let i=new iR(n.target,t,r,n.sequenceNumber);sM(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){tE(sN,"Failed to raise snapshot:",t),await s$(e,t)}}async function s$(e,t,r){if(!re(t))throw t;e.Ea.add(1),await sR(e),e.Ra.set("Offline"),r||(r=()=>sn(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tE(sN,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await sk(e)})}function sG(e,t){return t().catch(r=>s$(e,r,t))}async function sK(e){var t;let r=s2(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;sF(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=s2(e);r.O_()&&r.X_&&r.ea(t.mutations)}(e,t)}catch(t){await s$(e,t)}sH(e)&&sQ(e)}function sH(e){return sF(e)&&!s2(e).x_()&&e.Ta.length>0}function sQ(e){s2(e).start()}async function sW(e){s2(e).ra()}async function sX(e){let t=s2(e);for(let r of e.Ta)t.ea(r.mutations)}async function sY(e,t,r){let n=e.Ta.shift(),i=n2.from(n,t,r);await sG(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await sK(e)}async function sJ(e,t){t&&s2(e).X_&&await async function(e,t){var r;if(function(e){switch(e){case tI.OK:return t_(64938);case tI.CANCELLED:case tI.UNKNOWN:case tI.DEADLINE_EXCEEDED:case tI.RESOURCE_EXHAUSTED:case tI.INTERNAL:case tI.UNAVAILABLE:case tI.UNAUTHENTICATED:return!1;case tI.INVALID_ARGUMENT:case tI.NOT_FOUND:case tI.ALREADY_EXISTS:case tI.PERMISSION_DENIED:case tI.FAILED_PRECONDITION:case tI.ABORTED:case tI.OUT_OF_RANGE:case tI.UNIMPLEMENTED:case tI.DATA_LOSS:return!0;default:return t_(15467,{code:e})}}(r=t.code)&&r!==tI.ABORTED){let r=e.Ta.shift();s2(e).B_(),await sG(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await sK(e)}}(e,t),sH(e)&&sQ(e)}async function sZ(e,t){e.asyncQueue.verifyOperationInProgress(),tE(sN,"RemoteStore received new credentials");let r=sF(e);e.Ea.add(3),await sR(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await sk(e)}async function s0(e,t){t?(e.Ea.delete(2),await sk(e)):t||(e.Ea.add(2),await sR(e),e.Ra.set("Unknown"))}function s1(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Xo:sU.bind(null,e),t_:sB.bind(null,e),r_:sq.bind(null,e),H_:sz.bind(null,e)},t.sa(),e.ma=new sS(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.da.push(async t=>{t?(e.ma.B_(),sj(e)?sV(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function s2(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Xo:()=>Promise.resolve(),t_:sW.bind(null,e),r_:sJ.bind(null,e),ta:sX.bind(null,e),na:sY.bind(null,e)},t.sa(),e.fa=new s_(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.da.push(async t=>{t?(e.fa.B_(),await sK(e)):(await e.fa.stop(),e.Ta.length>0&&(tE(sN,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class s3{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new tD,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new s3(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tN(tI.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function s6(e,t){if(tT("AsyncQueue",`${t}: ${e}`),re(e))return new tN(tI.UNAVAILABLE,`${t}: ${e}`);throw e}class s5{static emptySet(e){return new s5(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||tW.comparator(t.key,r.key):(e,t)=>tW.comparator(e.key,t.key),this.keyedMap=nE(),this.sortedSet=new ra(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof s5)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new s5;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class s4{constructor(){this.ga=new ra(tW.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):t_(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class s8{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new s8(e,t,s5.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class s7{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class s9{constructor(){this.queries=ae(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new tN(tI.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=ae(),t.forEach((t,r)=>{for(let t of r.Sa)t.onError(e)})}}function ae(){return new nv(e=>np(e),nf)}async function at(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.ba()&&t.Da()&&(r=2):(i=new s7,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=s6(r,`Initialization of query '${nm(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&as(e)}async function ar(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?n=+!t.Da():!i.ba()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function an(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Fa(n)&&(r=!0);i.wa=n}}r&&as(e)}function ai(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.Sa)e.onError(r);e.queries.delete(t)}function as(e){e.Ca.forEach(e=>{e.next()})}(w=v||(v={})).Ma="default",w.Cache="cache";class aa{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new s8(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=s8.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==v.Cache}}class ao{constructor(e){this.key=e}}class al{constructor(e){this.key=e}}class ah{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=nC(),this.mutatedKeys=nC(),this.eu=ny(e),this.tu=new s5(this.eu)}get nu(){return this.Ya}ru(e,t){let r=t?t.iu:new s4,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let h=n.get(e),u=ng(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(r.track({type:3,doc:u}),f=!0):this.su(h,u)||(r.track({type:2,doc:u}),f=!0,(o&&this.eu(u,o)>0||l&&0>this.eu(u,l))&&(a=!0)):!h&&u?(r.track({type:0,doc:u}),f=!0):h&&!u&&(r.track({type:1,doc:h}),f=!0,(o||l)&&(a=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return t_(20277,{Rt:e})}})(r)-i(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Xa.size&&this.current&&!n?1:0,l=o!==this.Za;return(this.Za=o,0!==s.length||l)?{snapshot:new s8(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new s4,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=nC(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new al(e))}),this.Xa.forEach(r=>{e.has(r)||t.push(new ao(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=nC();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return s8.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}let au="SyncEngine";class ac{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class ad{constructor(e){this.key=e,this.hu=!1}}class af{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new nv(e=>np(e),nf),this.Iu=new Map,this.Eu=new Set,this.du=new ra(tW.comparator),this.Au=new Map,this.Ru=new iY,this.Vu={},this.mu=new Map,this.fu=iF.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function ap(e,t,r=!0){let n,i=aM(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await ag(i,t,r,!0),n}async function am(e,t){let r=aM(e);await ag(r,t,!0,!1)}async function ag(e,t,r,n){var i,s;let a,o=await (i=e.localStore,s=nc(t),i.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return i.Pi.getTargetData(e,s).next(r=>r?(t=r,t9.resolve(t)):i.Pi.allocateTargetId(e).next(r=>(t=new iR(s,r,"TargetPurposeListen",e.currentSequenceNumber),i.Pi.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=i.Ms.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(i.Ms=i.Ms.insert(e.targetId,e),i.xs.set(s,e.targetId)),e})),l=o.targetId,h=e.sharedClientState.addLocalQueryTarget(l,r);return n&&(a=await ay(e,t,l,"current"===h,o.resumeToken)),e.isPrimaryClient&&r&&sO(e.remoteStore,o),a}async function ay(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Cs&&(i=await ss(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return aD(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await ss(e.localStore,t,!0),a=new ah(t,s.Qs),o=a.ru(s.documents),l=ir.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),h=a.applyChanges(o,e.isPrimaryClient,l);aD(e,r,h.au);let u=new ac(t,r,a);return e.Tu.set(t,u),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),h.snapshot}async function av(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);i.length>1?(e.Iu.set(n.targetId,i.filter(e=>!nf(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await si(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&sL(e.remoteStore,n.targetId),aI(e,n.targetId)}).catch(t7)):(aI(e,n.targetId),await si(e.localStore,n.targetId,!0))}async function aw(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),sL(e.remoteStore,r.targetId))}async function ab(e,t,r){var n,i,s;let a=((n=e).remoteStore.remoteSyncer.applySuccessfulWrite=aS.bind(null,n),n.remoteStore.remoteSyncer.rejectFailedWrite=a_.bind(null,n),n);try{let e,n,o,l,h,u=await (i=a.localStore,o=t6.now(),l=t.reduce((e,t)=>e.add(t.key),nC()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let s=nw,a=nC();return i.Ns.getEntries(r,l).next(e=>{(s=e).forEach((e,t)=>{t.isValidDocument()||(a=a.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,s)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=nk(n.transform,e||null);null!=i&&(null===r&&(r=rQ.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new nW(r.key,t,function e(t){let r=[];return ri(t.fields,(t,n)=>{let i=new tQ([t]);if(r$(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new rc(r)}(t.value.mapValue),nq.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{n=t;let s=t.applyToLocalDocumentSet(e,a);return i.documentOverlayCache.saveOverlays(r,t.batchId,s)})}).then(()=>({batchId:n.batchId,changes:nT(e)})));a.sharedClientState.addPendingMutation(u.batchId),s=u.batchId,(h=a.Vu[a.currentUser.toKey()])||(h=new ra(tU)),h=h.insert(s,r),a.Vu[a.currentUser.toKey()]=h,await aR(a,u.changes),await sK(a.remoteStore)}catch(t){let e=s6(t,"Failed to persist write");r.reject(e)}}async function aE(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.Ms,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{var s,a,o;let l,h,u=r.Ns.newChangeBuffer({trackRemovals:!0});i=r.Ms;let c=[];t.targetChanges.forEach((s,a)=>{var o;let l=i.get(a);if(!l)return;c.push(r.Pi.removeMatchingKeys(e,s.removedDocuments,a).next(()=>r.Pi.addMatchingKeys(e,s.addedDocuments,a)));let h=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?h=h.withResumeToken(rf.EMPTY_BYTE_STRING,t5.min()).withLastLimboFreeSnapshotVersion(t5.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(a,h),o=h,(0===l.resumeToken.approximateByteSize()||o.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(r.Pi.updateTargetData(e,h))});let d=nw,f=nC();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&c.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),c.push((s=e,a=u,o=t.documentUpdates,l=nC(),h=nC(),o.forEach(e=>l=l.add(e)),a.getEntries(s,l).next(e=>{let t=nw;return o.forEach((r,n)=>{let i=e.get(r);n.isFoundDocument()!==i.isFoundDocument()&&(h=h.add(r)),n.isNoDocument()&&n.version.isEqual(t5.min())?(a.removeEntry(r,n.readTime),t=t.insert(r,n)):!i.isValidDocument()||n.version.compareTo(i.version)>0||0===n.version.compareTo(i.version)&&i.hasPendingWrites?(a.addEntry(n),t=t.insert(r,n)):tE(se,"Ignoring outdated watch update for ",r,". Current version:",i.version," Watch version:",n.version)}),{ks:t,qs:h}})).next(e=>{d=e.ks,f=e.qs})),!n.isEqual(t5.min())){let t=r.Pi.getLastRemoteSnapshotVersion(e).next(t=>r.Pi.setTargetsMetadata(e,e.currentSequenceNumber,n));c.push(t)}return t9.waitFor(c).next(()=>u.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,d,f)).next(()=>d)}).then(e=>(r.Ms=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(tA(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?tA(n.hu,14607):t.removedDocuments.size>0&&(tA(n.hu,42227),n.hu=!1))}),await aR(e,s,t)}catch(e){await t7(e)}}function aT(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.Sa)e.va(t)&&(r=!0)}),r&&as(n),i.length&&e.Pu.H_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function ax(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new ra(tW.comparator);r=r.insert(i,rW.newNoDocument(i,t5.min()));let n=nC().add(i),s=new it(t5.min(),new Map,new ra(tU),r,n);await aE(e,s),e.du=e.du.remove(i),e.Au.delete(t),ak(e)}else await si(e.localStore,t,!1).then(()=>aI(e,t,r)).catch(t7)}async function aS(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.Ns.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=t9.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);tA(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=nC();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));aA(e,n,null),aC(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await aR(e,i)}catch(e){await t7(e)}}async function a_(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(tA(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));aA(e,t,r),aC(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await aR(e,i)}catch(e){await t7(e)}}function aC(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function aA(e,t,r){let n=e.Vu[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.Vu[e.currentUser.toKey()]=n}}function aI(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||aN(e,t)})}function aN(e,t){e.Eu.delete(t.path.canonicalString());let r=e.du.get(t);null!==r&&(sL(e.remoteStore,r),e.du=e.du.remove(t),e.Au.delete(r),ak(e))}function aD(e,t,r){for(let n of r)n instanceof ao?(e.Ru.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.du.get(r)||e.Eu.has(n)||(tE(au,"New document in limbo: "+r),e.Eu.add(n),ak(e))}(e,n)):n instanceof al?(tE(au,"Document no longer in limbo: "+n.key),e.Ru.removeReference(n.key,t),e.Ru.containsKey(n.key)||aN(e,n.key)):t_(19791,{wu:n})}function ak(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new tW(tK.fromString(t)),n=e.fu.next();e.Au.set(n,new ad(r)),e.du=e.du.insert(r,n),sO(e.remoteStore,new iR(nc(new nl(r.path)),n,"TargetPurposeLimboResolution",rt.ce))}}async function aR(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=i8.As(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.H_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>t9.forEach(t,t=>t9.forEach(t.Es,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>t9.forEach(t.ds,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!re(e))throw e;tE(se,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.Ms.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.Ms=e.Ms.insert(t,i)}}}(e.localStore,i))}async function aO(e,t){if(!e.currentUser.isEqual(t)){tE(au,"User change. New user:",t.toKey());let r=await sr(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new tN(tI.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await aR(e,r.Ls)}}function aL(e,t){let r=e.Au.get(t);if(r&&r.hu)return nC().add(r.key);{let r=nC(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}function aM(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=aE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=aL.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ax.bind(null,e),e.Pu.H_=an.bind(null,e.eventManager),e.Pu.yu=ai.bind(null,e.eventManager),e}class aP{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sb(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new i9,new st(t,r,e.initialUser,this.serializer)}Cu(e){return new i3(i5.mi,this.serializer)}Du(e){return new so}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}aP.provider={build:()=>new aP};class aV extends aP{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return tA(this.persistence.referenceDelegate instanceof i4,46915),new iz(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?ij.withCacheSize(this.cacheSizeBytes):ij.DEFAULT;return new i3(e=>i4.mi(e,t),this.serializer)}}class aj{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>aT(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=aO.bind(null,this.syncEngine),await s0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new s9}createDatastore(e){var t;let r=sb(e.databaseInfo.databaseId),n=new sv(e.databaseInfo);return t=e.authCredentials,new sA(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new sD(t,r,e.asyncQueue,e=>aT(this.syncEngine,e,0),su.v()?new su:new sl)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new af(r,n,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){tE(sN,"RemoteStore shutting down."),e.Ea.add(5),await sR(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}aj.provider={build:()=>new aj};class aF{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):tT("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}let aU="FirestoreClient";class aB{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=ty.UNAUTHENTICATED,this.clientId=tF.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{tE(aU,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(tE(aU,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new tD;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=s6(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function aq(e,t){e.asyncQueue.verifyOperationInProgress(),tE(aU,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await sr(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function az(e,t){e.asyncQueue.verifyOperationInProgress();let r=await a$(e);tE(aU,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>sZ(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>sZ(t.remoteStore,r)),e._onlineComponents=t}async function a$(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tE(aU,"Using user provided OfflineComponentProvider");try{await aq(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===tI.FAILED_PRECONDITION||t.code===tI.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;tx("Error using user provided cache. Falling back to memory cache: "+t),await aq(e,new aP)}}else tE(aU,"Using default OfflineComponentProvider"),await aq(e,new aV(void 0));return e._offlineComponents}async function aG(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tE(aU,"Using user provided OnlineComponentProvider"),await az(e,e._uninitializedComponentsProvider._online)):(tE(aU,"Using default OnlineComponentProvider"),await az(e,new aj))),e._onlineComponents}async function aK(e){let t=await aG(e),r=t.eventManager;return r.onListen=ap.bind(null,t.syncEngine),r.onUnlisten=av.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=am.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=aw.bind(null,t.syncEngine),r}function aH(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let aQ=new Map,aW="firestore.googleapis.com";class aX{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new tN(tI.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=aW,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new tN(tI.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new tN(tI.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aH(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new tN(tI.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new tN(tI.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new tN(tI.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class aY{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new aX({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new tN(tI.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new tN(tI.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new aX(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new tR;switch(e.type){case"firstParty":return new tP(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new tN(tI.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=aQ.get(this))&&(tE("ComponentProvider","Removing Datastore"),aQ.delete(this),e.terminate()),Promise.resolve()}}class aJ{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new aJ(this.firestore,e,this._query)}}class aZ{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new a0(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new aZ(this.firestore,e,this._key)}toJSON(){return{type:aZ._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(t3(t,aZ._jsonSchema))return new aZ(e,r||null,new tW(tK.fromString(t.referencePath)))}}aZ._jsonSchemaVersion="firestore/documentReference/1.0",aZ._jsonSchema={type:t2("string",aZ._jsonSchemaVersion),referencePath:t2("string")};class a0 extends aJ{constructor(e,t,r){super(e,t,new nl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new aZ(this.firestore,null,new tW(e))}withConverter(e){return new a0(this.firestore,e,this._path)}}function a1(e,t,...r){if(e=eu(e),1==arguments.length&&(t=tF.newId()),tX("doc","path",t),e instanceof aY){let n=tK.fromString(t,...r);return tY(n),new aZ(e,null,new tW(n))}{if(!(e instanceof aZ||e instanceof a0))throw new tN(tI.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(tK.fromString(t,...r));return tY(n),new aZ(e.firestore,e instanceof a0?e.converter:null,new tW(n))}}let a2="AsyncQueue";class a3{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new sE(this,"async_queue_retry"),this._c=()=>{let e=sw();e&&tE(a2,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=sw();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=sw();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new tD;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!re(e))throw e;tE(a2,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,tT("INTERNAL UNHANDLED ERROR: ",a6(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=s3.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&t_(47125,{Pc:a6(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function a6(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class a5 extends aY{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new a3,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new a3(e),this._firestoreClient=void 0,await e}}}function a4(e){if(e._terminated)throw new tN(tI.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n;let i,s=e._freezeSettings(),a=(t=e._databaseId,r=e._app?.options.appId||"",new r_(t,r,e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,aH(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator));e._componentsProvider||s.localCache?._offlineComponentProvider&&s.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new aB(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&(n=e._componentsProvider,i=n?._online.build(),{_offline:n?._offline.build(i),_online:i}))}(e),e._firestoreClient}class a8{constructor(e){this._byteString=e}static fromBase64String(e){try{return new a8(rf.fromBase64String(e))}catch(e){throw new tN(tI.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new a8(rf.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:a8._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(t3(e,a8._jsonSchema))return a8.fromBase64String(e.bytes)}}a8._jsonSchemaVersion="firestore/bytes/1.0",a8._jsonSchema={type:t2("string",a8._jsonSchemaVersion),bytes:t2("string")};class a7{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new tN(tI.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tQ(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class a9{constructor(e){this._methodName=e}}class oe{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tN(tI.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tN(tI.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return tU(this._lat,e._lat)||tU(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:oe._jsonSchemaVersion}}static fromJSON(e){if(t3(e,oe._jsonSchema))return new oe(e.latitude,e.longitude)}}oe._jsonSchemaVersion="firestore/geoPoint/1.0",oe._jsonSchema={type:t2("string",oe._jsonSchemaVersion),latitude:t2("number"),longitude:t2("number")};class ot{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:ot._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(t3(e,ot._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new ot(e.vectorValues);throw new tN(tI.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ot._jsonSchemaVersion="firestore/vectorValue/1.0",ot._jsonSchema={type:t2("string",ot._jsonSchemaVersion),vectorValues:t2("object")};let or=/^__.*__$/;class on{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new nW(e,this.data,this.fieldMask,t,this.fieldTransforms):new nQ(e,this.data,t,this.fieldTransforms)}}function oi(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw t_(40011,{Ac:e})}}class os{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new os({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return od(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(oi(this.Ac)&&or.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class oa{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||sb(e)}Cc(e,t,r,n=!1){return new os({Ac:e,methodName:t,Dc:r,path:tQ.emptyPath(),fc:!1,bc:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}class oo extends a9{_toFieldTransform(e){return new nU(e.path,new nR)}isEqual(e){return e instanceof oo}}function ol(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof t6||e instanceof oe||e instanceof a8||e instanceof aZ||e instanceof a9||e instanceof ot)}function oh(e,t,r){if(!ol(r)||!tZ(r)){let n=t0(r);throw"an object"===n?t.Sc(e+" a custom object"):t.Sc(e+" "+n)}}let ou=RegExp("[~\\*/\\[\\]]");function oc(e,t,r){if(t.search(ou)>=0)throw od(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new a7(...t.split("."))._internalPath}catch(n){throw od(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function od(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new tN(tI.INVALID_ARGUMENT,o+e+l)}class of{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new aZ(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new op(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(om("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class op extends of{data(){return super.data()}}function om(e,t){return"string"==typeof t?oc(e,t):t instanceof a7?t._internalPath:t._delegate._internalPath}class og{convertValue(e,t="none"){switch(rO(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rg(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ry(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw t_(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return ri(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new ot(e.fields?.[rR].arrayValue?.values?.map(e=>rg(e.doubleValue)))}convertGeoPoint(e){return new oe(rg(e.latitude),rg(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=rx(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(rS(e));default:return null}}convertTimestamp(e){let t=rm(e);return new t6(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=tK.fromString(e);tA(ik(r),9688,{name:e});let n=new rA(r.get(1),r.get(3)),i=new tW(r.popFirst(5));return n.isEqual(t)||tT(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class oy{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ov extends of{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ow(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(om("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new tN(tI.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=ov._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}ov._jsonSchemaVersion="firestore/documentSnapshot/1.0",ov._jsonSchema={type:t2("string",ov._jsonSchemaVersion),bundleSource:t2("string","DocumentSnapshot"),bundleName:t2("string"),bundle:t2("string")};class ow extends ov{data(e={}){return super.data(e)}}class ob{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new oy(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ow(this._firestore,this._userDataWriter,r.key,r,new oy(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new tN(tI.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new ow(e._firestore,e._userDataWriter,r.doc.key,r.doc,new oy(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new ow(e._firestore,e._userDataWriter,t.doc.key,t.doc,new oy(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return t_(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new tN(tI.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=ob._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=tF.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}ob._jsonSchemaVersion="firestore/querySnapshot/1.0",ob._jsonSchema={type:t2("string",ob._jsonSchemaVersion),bundleSource:t2("string","QuerySnapshot"),bundleName:t2("string"),bundle:t2("string")};class oE extends og{constructor(e){super(),this.firestore=e}convertBytes(e){return new a8(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new aZ(this.firestore,null,t)}}function oT(e,t,r){var n;let i,s;e=t1(e,aZ);let a=t1(e.firestore,a5),o=(n=e.converter,n?r&&(r.merge||r.mergeFields)?n.toFirestore(t,r):n.toFirestore(t):t);return function(e,t){var r;let n;return r=a4(e),n=new tD,r.asyncQueue.enqueueAndForget(async()=>ab(await aG(r).then(e=>e.syncEngine),t,n)),n.promise}(a,[(function(e,t,r,n,i,s={}){let a,o,l=e.Cc(s.merge||s.mergeFields?2:0,t,r,i);oh("Data must be an object, but it was:",l,n);let h=function e(t,r){let n={};return rs(t)?r.path&&r.path.length>0&&r.fieldMask.push(r.path):ri(t,(t,i)=>{let s=function t(r,n){if(ol(r=eu(r)))return oh("Unsupported field value:",n,r),e(r,n);if(r instanceof a9)return function(e,t){if(!oi(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(r,n),null;if(void 0===r&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),r instanceof Array){if(n.settings.fc&&4!==n.Ac)throw n.Sc("Nested arrays are not supported");let e=[],i=0;for(let s of r){let r=t(s,n.wc(i));null==r&&(r={nullValue:"NULL_VALUE"}),e.push(r),i++}return{arrayValue:{values:e}}}return function(e,t){var r,n,i;if(null===(e=eu(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return r=t.serializer,"number"==typeof(i=n=e)&&Number.isInteger(i)&&!rr(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER?nN(n):nI(r,n);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=t6.fromDate(e);return{timestampValue:iy(t.serializer,r)}}if(e instanceof t6){let r=new t6(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:iy(t.serializer,r)}}if(e instanceof oe)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof a8)return{bytesValue:iv(t.serializer,e._byteString)};if(e instanceof aZ){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.Sc(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:ib(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof ot)return{mapValue:{fields:{[rI]:{stringValue:rk},[rR]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return nI(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${t0(e)}`)}(r,n)}(i,r.mc(t));null!=s&&(n[t]=s)}),{mapValue:{fields:n}}}(n,l);if(s.merge)a=new rc(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=function(e,t,r){if((t=eu(t))instanceof a7)return t._internalPath;if("string"==typeof t)return oc(e,t);throw od("Field path arguments must be of type string or ",e,!1,void 0,r)}(t,n,r);if(!l.contains(i))throw new tN(tI.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);(function(e,t){return e.some(e=>e.isEqual(t))})(e,i)||e.push(i)}a=new rc(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new on(new rQ(h),a,o)})((i=a._freezeSettings(),s=sb(a._databaseId),new oa(a._databaseId,!!i.ignoreUndefinedProperties,s)),"setDoc",e._key,o,null!==e.converter,r).toMutation(e._key,nq.none())])}new WeakMap,function(e=!0){tv=e1,e$(new ec("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new a5(new tL(t.getProvider("auth-internal")),new tj(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new tN(tI.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rA(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),e8(tm,tg,void 0),e8(tm,tg,"esm2020")}();let ox=function(e,t){let r=eG("object"==typeof e?e:e6(),"firestore").getImmediate({identifier:"string"==typeof e?e:rC});if(!r._initialized){let e=(e=>{let t=Y()?.emulatorHosts?.[e];if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]})("firestore");e&&function(e,t,r,n={}){e=t1(e,aY);let i=ee(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(et(`https://${o}`),function(e,t){if("undefined"==typeof window||"undefined"==typeof document||!ee(window.location.host)||er[e]===t||er[e]||en)return;function r(e){return`__firebase__banner__${e}`}er[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(er))er[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),h=document.getElementById(l)||document.createElement("a"),u=r("preprendIcon"),c=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let r=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;en=!0,(e=document.getElementById(n))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",u),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,h,r),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}("Firestore",!0)),s.host!==aW&&s.host!==o&&tx("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!el(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=ty.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[W(JSON.stringify({alg:"none",type:"JWT"})),W(JSON.stringify(s)),""].join(".")}(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new tN(tI.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new ty(i)}e._authCredentials=new tO(new tk(t,r))}}(r,...e)}return r}(e2({apiKey:"AIzaSyBTeQSKtaXdm5tI9APbniKGbvwhQP205JU",authDomain:"orcamento-44592.firebaseapp.com",projectId:"orcamento-44592",storageBucket:"orcamento-44592.firebasestorage.app",messagingSenderId:"946840065878",appId:"1:946840065878:web:432102f1113927e6cb28f7",measurementId:"G-M1S34G3D62"})),oS="base_prices",o_="global_prices",oC=[{id:"boiler2",description:"RESERVATRIO DE 200 LTS BAIXA PRESSO KISOLTEC",unitPrice:2408,qty:0,details:"Reservatrio interno em INOX 304, Revestimento em Poliuretano Expandido, Apoio eltrico 3000W."},{id:"boiler3",description:"RESERVATRIO DE 300 LTS BAIXA PRESSO KISOLTEC",unitPrice:2898,qty:0,details:"Reservatrio interno em INOX 304, Revestimento em Poliuretano Expandido, Apoio eltrico 3000W."},{id:"boiler4",description:"RESERVATRIO DE 400 LTS BAIXA PRESSO KISOLTEC",unitPrice:3315,qty:0,details:"Reservatrio interno em INOX 304, Revestimento em Poliuretano Expandido, Apoio eltrico 3000W."},{id:"boiler5",description:"RESERVATRIO DE 500 LTS BAIXA PRESSO KISOLTEC",unitPrice:3864,qty:0,details:"Reservatrio interno em INOX 304, Revestimento em Poliuretano Expandido, Apoio eltrico 3000W."},{id:"boiler6",description:"RESERVATRIO DE 600 LTS BAIXA PRESSO KISOLTEC",unitPrice:4447,qty:0,details:"Reservatrio interno em INOX 304, Revestimento em Poliuretano Expandido, Apoio eltrico 3000W."},{id:"boiler8",description:"RESERVATRIO DE 800 LTS BAIXA PRESSO KISOLTEC",unitPrice:5315,qty:0,details:"Reservatrio interno em INOX 304, Revestimento em Poliuretano Expandido, Apoio eltrico 3000W."},{id:"boiler10",description:"RESERVATRIO DE 1000 LTS BAIXA PRESSO KISOLTEC",unitPrice:6157,qty:0,details:"Reservatrio interno em INOX 304, Revestimento em Poliuretano Expandido, Apoio eltrico 3000W."},{id:"placas",description:"COLETORES SOLAR KISOLTEC - MODELO ULTRATEC 1.50x0.90",unitPrice:1220,qty:0,details:"Mximo aproveitamento por m, Certificado pelo INMETRO e Selo PROCEL."},{id:"placas2",description:"COLETORES SOLAR KISOLTEC - MODELO ULTRATEC 2.00x0.90",unitPrice:1536,qty:0,details:"Mximo aproveitamento por m, Certificado pelo INMETRO e Selo PROCEL."},{id:"pressurizador",description:"PRESSURIZADOR MAX POWER (EM INOX)",unitPrice:1425,qty:0,details:"Garante presso ideal ps-boiler."},{id:"kit_instalacao",description:"KIT MATERIAL (EM COBRE) P/INSTALAO (ESTIMATIVA)",unitPrice:1900,qty:0,details:"Tubulao e conexes para montagem do sistema."},{id:"timer",description:"TIMER DIGITAL TLZ",unitPrice:580,qty:0,details:"Controle de apoio eltrico."},{id:"mao_obra",description:"MO DE OBRA DE INSTALAO (ESTIMATIVA)",unitPrice:950,qty:0,details:"Instalao e testes do sistema completo."}],oA=e=>parseFloat(String(e).replace(/[^0-9,.]/g,"").replace(",","."))||0,oI=e=>`R$ ${parseFloat(e).toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}`,oN=({client:e,handleClientChange:t})=>(0,b.jsxs)("div",{className:"bg-white p-6 shadow-xl rounded-lg border-t-4 border-blue-500",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold mb-4 flex items-center text-gray-700",children:[(0,b.jsx)(A,{className:"w-5 h-5 mr-2 text-blue-500"}),"1. Dados do Cliente"]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["nome","telefone","email","endereco","cidade"].map(r=>(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsxs)("label",{htmlFor:r,className:"text-sm font-medium text-gray-600 mb-1 capitalize flex items-center",children:["nome"===r&&(0,b.jsx)(A,{className:"w-4 h-4 mr-1 text-blue-400"}),"telefone"===r&&(0,b.jsx)(M,{className:"w-4 h-4 mr-1 text-blue-400"}),"email"===r&&(0,b.jsx)(L,{className:"w-4 h-4 mr-1 text-blue-400"}),"endereco"===r&&(0,b.jsx)(O,{className:"w-4 h-4 mr-1 text-blue-400"}),"cidade"===r&&(0,b.jsx)(P,{className:"w-4 h-4 mr-1 text-blue-400"}),r.charAt(0).toUpperCase()+r.slice(1)]}),(0,b.jsx)("input",{id:r,type:"email"===r?"email":"text",value:e[r],onChange:e=>t(r,e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150",placeholder:`Digite o ${r}...`})]},r))})]}),oD=({items:e,handleItemChange:t,totalValue:r})=>(0,b.jsxs)("div",{className:"bg-white p-6 shadow-xl rounded-lg border-t-4 border-green-500",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold mb-4 flex items-center text-gray-700",children:[(0,b.jsx)(V,{className:"w-5 h-5 mr-2 text-green-500"}),"2. Itens e Valores"]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"text-left bg-gray-50 text-xs font-medium text-gray-500 uppercase tracking-wider",children:[(0,b.jsx)("th",{className:"p-3 w-16",children:"QTDE"}),(0,b.jsx)("th",{className:"p-3 w-72",children:"ITEM"}),(0,b.jsx)("th",{className:"p-3 w-32 text-right",children:"PREO UNIT. (R$)"}),(0,b.jsx)("th",{className:"p-3 w-32 text-right",children:"SUBTOTAL"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-200",children:e.map(e=>(0,b.jsxs)("tr",{className:"hover:bg-green-50/50",children:[(0,b.jsx)("td",{className:"p-2",children:(0,b.jsx)("input",{type:"number",value:e.qty,min:"0",onChange:r=>t(e.id,"qty",r.target.value),className:"w-full text-center p-1 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150 text-sm"})}),(0,b.jsxs)("td",{className:"p-2",children:[(0,b.jsx)("input",{type:"text",value:e.description,onChange:r=>t(e.id,"description",r.target.value),className:"w-full p-1 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150 text-sm"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.details})]}),(0,b.jsx)("td",{className:"p-2 text-right",children:(0,b.jsx)("input",{type:"text",value:e.unitPrice.toFixed(2).replace(".",","),onChange:r=>t(e.id,"unitPrice",r.target.value),className:"w-full text-right p-1 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150 text-sm font-mono",placeholder:"0,00"})}),(0,b.jsx)("td",{className:"p-2 text-right font-bold text-gray-700 font-mono",children:oI(e.qty*e.unitPrice)})]},e.id))}),(0,b.jsx)("tfoot",{children:(0,b.jsxs)("tr",{className:"bg-green-100 text-green-800 font-bold text-lg",children:[(0,b.jsx)("td",{colSpan:"3",className:"p-3 text-right",children:"TOTAL GERAL"}),(0,b.jsx)("td",{className:"p-3 text-right",children:oI(r)})]})})]})})]}),ok=({userId:e,isAuthReady:t,basePrices:r,saveBasePrices:n,loadingHook:i})=>{let[s,a]=(0,E.useState)({}),[o,l]=(0,E.useState)(!1);(0,E.useEffect)(()=>{if(r){let e={};oC.forEach(t=>{let n=r[t.id]||t.unitPrice;e[t.id]=oA(n).toFixed(2).replace(".",",")}),a(e)}},[r]);let h=async()=>{l(!0),await n(s)?alert("Preos base salvos com sucesso no Firestore!"):alert("Erro ao salvar preos base. Verifique o console."),l(!1)};return i&&0===Object.keys(r).length?(0,b.jsxs)("div",{className:"flex items-center justify-center p-8 bg-white rounded-xl shadow-xl min-h-[300px]",children:[(0,b.jsx)(k,{className:"w-6 h-6 text-yellow-500 animate-spin"}),(0,b.jsx)("p",{className:"ml-2 text-gray-700",children:"Carregando configuraes..."})]}):(0,b.jsxs)("div",{className:"bg-white p-6 shadow-xl rounded-lg border-t-4 border-yellow-500",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold mb-4 flex items-center text-gray-700",children:[(0,b.jsx)(I,{className:"w-5 h-5 mr-2 text-yellow-500"}),"Configurao de Preos Base"]}),(0,b.jsx)("div",{className:"grid grid-cols-1 gap-4",children:oC.map(e=>(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsxs)("label",{htmlFor:`price-${e.id}`,className:"text-sm font-medium text-gray-600 mb-1 flex items-center",children:[(0,b.jsx)(V,{className:"w-4 h-4 mr-1 text-blue-500"}),"Preo Base - ",e.description.split("(")[0].trim()]}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("span",{className:"p-2 bg-gray-100 rounded-l-lg border border-gray-300 text-gray-600 text-sm",children:"R$"}),(0,b.jsx)("input",{id:`price-${e.id}`,type:"text",value:s[e.id]||"",onChange:t=>{var r;let n;return r=e.id,n=t.target.value.replace(/[^0-9,]/g,""),void a(e=>({...e,[r]:n}))},className:"w-full p-2 border border-gray-300 rounded-r-lg focus:ring-yellow-500 focus:border-yellow-500 transition duration-150 text-right",placeholder:"0,00"})]})]},e.id))}),(0,b.jsx)("div",{className:"mt-6 flex justify-end",children:(0,b.jsxs)("button",{onClick:h,className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200 flex items-center disabled:opacity-50",disabled:o,children:[o?(0,b.jsx)(k,{className:"w-5 h-5 mr-2 animate-spin"}):(0,b.jsx)(D,{className:"w-5 h-5 mr-2"}),o?"Salvando...":"Salvar Preos Base no Firestore"]})}),(0,b.jsxs)("p",{className:"mt-4 text-xs text-gray-500 flex items-start",children:[(0,b.jsx)(B,{className:"w-4 h-4 mr-1 mt-0.5 flex-shrink-0 text-red-400"}),"Estes preos so persistentes (**Firestore**) e aplicados automaticamente."]})]})},oR=({client:e,onGeneratePdf:t,isGenerating:r})=>{let n=e.nome||"Cliente",i=e.telefone.replace(/\D/g,""),s=`Ol\xe1 ${n}, aqui est\xe1 o seu or\xe7amento de Aquecimento Solar. Por favor, baixe o arquivo PDF gerado e anexe-o nesta conversa.`,a=`https://wa.me/${i}?text=${encodeURIComponent(s)}`;return(0,b.jsxs)("button",{onClick:()=>{t(),setTimeout(()=>{window.open(a,"_blank")},1e3)},className:"bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-200 flex items-center disabled:opacity-50",disabled:r||!e.telefone,title:e.telefone?"Gera o PDF e abre o WhatsApp (o usurio deve anexar o PDF)":"Preencha o telefone do cliente para enviar pelo WhatsApp",children:[r?(0,b.jsx)(k,{className:"w-5 h-5 mr-2 animate-spin"}):(0,b.jsx)(q,{className:"w-5 h-5 mr-2"}),r?"Gerando PDF...":"Enviar por WhatsApp"]})},oO=E.default.forwardRef(({client:e,items:t,totalValue:r,userId:n},i)=>(0,b.jsxs)("div",{ref:i,"data-userid":n,className:"budget-view p-8 bg-white shadow-xl rounded-lg print:shadow-none print:p-0",children:[(0,b.jsxs)("div",{className:"header-print text-center border-b-2 border-cyan-500 pb-4 mb-6",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-cyan-600 uppercase tracking-widest",children:"A CASA DOS AQUECEDORES"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"SOLAR, ELTRICO, GS E BOMBAS DE CALOR P/ PISCINAS."}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"FONE (15) 3227-3025 / (15) 99705-0935- SOROCABA/SP"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"E-mail: casa.aquecedores@yahoo.com.hr"})]}),(0,b.jsxs)("div",{className:"client-info-print grid grid-cols-2 gap-4 mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,b.jsxs)("div",{className:"col-span-2 text-lg font-bold text-blue-800 flex items-center mb-2 border-b border-blue-300 pb-1",children:[(0,b.jsx)(A,{className:"text-sm text-gray-600 mt-1"})," DADOS DO CLIENTE"]}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("strong",{children:"Nome:"})," ",e.nome||"-"]}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("strong",{children:"Telefone:"})," ",e.telefone||"-"]}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("strong",{children:"E-mail:"})," ",e.email||"-"]}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("strong",{children:"Cidade:"})," ",e.cidade||"-"]}),(0,b.jsxs)("div",{className:"col-span-2 text-sm",children:[(0,b.jsx)("strong",{children:"Endereo:"})," ",e.endereco||"-"]})]}),(0,b.jsxs)("div",{className:"text-center mb-6",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold text-gray-800 border-b-2 border-green-500 pb-1 inline-block",children:["ORAMENTO DE AQUECIMENTO SOLAR - ",new Date().toLocaleDateString("pt-BR")]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1"})]}),(0,b.jsxs)("table",{className:"items-table-print w-full border-collapse border border-gray-300",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-gray-100 text-sm",children:[(0,b.jsx)("th",{className:"p-3 border-r",children:"QTDE"}),(0,b.jsx)("th",{className:"p-3 border-r",children:"ITEM"}),(0,b.jsx)("th",{className:"p-3 border-r text-right",children:"VALOR UNITRIO"}),(0,b.jsx)("th",{className:"p-3 text-right",children:"VALOR TOTAL"})]})}),(0,b.jsxs)("tbody",{children:[t.filter(e=>e.qty>0).map(e=>(0,b.jsxs)("tr",{className:"text-gray-700 hover:bg-gray-50 transition duration-100",children:[(0,b.jsx)("td",{className:"p-3 border-r font-medium text-center w-16",children:e.qty.toFixed(0)}),(0,b.jsxs)("td",{className:"p-3 border-r",children:[(0,b.jsx)("strong",{className:"text-sm",children:e.description.split("(")[0].trim()}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:e.details})]}),(0,b.jsx)("td",{className:"p-3 border-r text-right w-36 font-mono",children:oI(e.unitPrice)}),(0,b.jsx)("td",{className:"p-3 text-right w-36 font-bold text-green-600 font-mono",children:oI(e.qty*e.unitPrice)})]},e.id)),(0,b.jsxs)("tr",{className:"total-row-print bg-cyan-100 font-bold text-cyan-800",children:[(0,b.jsx)("td",{colSpan:"3",className:"p-3 text-right text-md border-r-0",children:"TOTAL GERAL"}),(0,b.jsx)("td",{className:"p-3 text-right text-md border-l-0",children:oI(r)})]})]})]}),(0,b.jsxs)("div",{className:"notes-print mt-8 grid grid-cols-1 sm:grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"font-bold text-sm uppercase text-green-600 mb-2 border-b border-green-300 pb-1 flex items-center",children:[(0,b.jsx)(F,{className:"w-4 h-4 mr-1"}),"GARANTIAS"]}),(0,b.jsxs)("ul",{className:"text-gray-600 list-disc list-inside space-y-1 text-sm",children:[(0,b.jsx)("li",{children:"03 ANOS P/ RESERVATRIO (BOILER)"}),(0,b.jsx)("li",{children:"03 ANOS P/ COLETORES SOLAR"}),(0,b.jsx)("li",{children:"01 ANO P/ PRESSURIZADORES"}),(0,b.jsx)("li",{children:"03 MESES P/ TERMOSTATO, RESISTNCIA"}),(0,b.jsx)("li",{className:"mt-2 text-red-500",children:"A garantia no cobre intempries da natureza."})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"font-bold text-sm uppercase text-green-600 mb-2 border-b border-green-300 pb-1 flex items-center",children:[(0,b.jsx)(U,{className:"w-4 h-4 mr-1"}),"CONDIES GERAIS"]}),(0,b.jsxs)("ul",{className:"text-gray-600 list-disc list-inside space-y-1 text-sm",children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{className:"font-semibold",children:"CONDIES DE PAGAMENTO:"}),"  COMBINAR"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{className:"font-semibold",children:"PRAZO DE ENTREGA:"})," 10 DIAS TEIS, aps confirmao do pedido."]}),(0,b.jsx)("li",{className:"mt-2 font-semibold",children:"OBS: ORAMENTO SUJEITO  ALTERAES"}),(0,b.jsxs)("li",{children:["Vlido at: ",new Date(Date.now()+6048e5).toLocaleDateString("pt-BR")]})]})]})]}),(0,b.jsxs)("div",{className:"footer-print text-center mt-12 pt-6 border-t border-gray-300 text-gray-600",children:[(0,b.jsx)("p",{className:"font-semibold text-sm",children:"Roseli Sepulveda"}),(0,b.jsx)("p",{className:"font-semibold text-sm",children:"(15) 99705-0935"}),(0,b.jsxs)("p",{className:"text-xs mt-1",children:["Data: ",new Date().toLocaleDateString("pt-BR")]})]}),(0,b.jsx)("style",{children:`
            @media print {
                /* Estilos espec\xedficos para impress\xe3o */
                .no-print { display: none !important; }
                .budget-view { box-shadow: none !important; padding: 0 !important; }
                .client-info-print { grid-template-columns: 1fr 1fr; }
                .notes-print { grid-template-columns: 1fr 1fr; }
            }
            `})]}));e.s(["default",0,()=>{let{loading:t,userId:r,isAuthReady:n,client:i,items:s,totalValue:a,basePrices:o,handleClientChange:l,handleItemChange:h,saveBasePrices:u,saveBudget:c}=(()=>{let[e,t]=(0,E.useState)(!0),[r,n]=(0,E.useState)("user_local_123"),[i,s]=(0,E.useState)(!0),[a,o]=(0,E.useState)({}),[l,h]=(0,E.useState)({nome:"",telefone:"",email:"",endereco:"",cidade:"Sorocaba/SP"}),[u,c]=(0,E.useState)(oC.map(e=>({...e,unitPrice:e.unitPrice,qty:e.qty})));(0,E.useEffect)(()=>{let e=async()=>{t(!0);try{var e;let t,r=a1(ox,oS,o_),n=await (e=r,e=t1(e,aZ),t=t1(e.firestore,a5),(function(e,t,r={}){let n=new tD;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await aK(e),s=e.asyncQueue,a=new aF({next:e=>{a.Nu(),s.enqueueAndForget(()=>ar(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new tN(tI.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new tN(tI.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),o=new aa(new nl(t.path),a,{includeMetadataChanges:!0,qa:!0}),at(i,o)}),n.promise})(a4(t),e._key).then(r=>{var n,i,s;let a,o;return n=t,i=e,a=(s=r).docs.get(i._key),o=new oE(n),new ov(n,o,i._key,a,new oy(s.hasPendingWrites,s.fromCache),i.converter)})),i={};n.exists()?i=n.data():console.log("Documento de Preos Base no encontrado, usando defaults."),o(i),c(e=>e.map(e=>{let t=oA(i[e.id]),r=t>0?t:e.unitPrice;return{...e,unitPrice:r}}))}catch(e){console.error("Erro ao carregar preos base do Firestore:",e)}finally{t(!1)}};i&&e()},[i]);let d=(0,E.useCallback)((e,t)=>{h(r=>({...r,[e]:t}))},[]),f=(0,E.useCallback)((e,t,r)=>{c(n=>n.map(n=>{if(n.id===e){let e="description"===t?r:oA(r);return"qty"===t&&e<0&&(e=0),{...n,[t]:e}}return n}))},[]),p=(0,E.useMemo)(()=>u.reduce((e,t)=>e+t.qty*t.unitPrice,0),[u]),m=(0,E.useCallback)(async e=>{t(!0);try{let t={};Object.keys(e).forEach(r=>{t[r]=oA(e[r])});let r=a1(ox,oS,o_);return await oT(r,t,{merge:!0}),o(t),!0}catch(e){return console.error("Erro ao salvar preos base no Firestore:",e),!1}finally{t(!1)}},[]),g=(0,E.useCallback)(async()=>{t(!0);try{let e={client:l,items:u.map(e=>({description:e.description,qty:e.qty,unitPrice:e.unitPrice,subtotal:e.qty*e.unitPrice,details:e.details})),totalValue:p,createdBy:r,createdAt:new oo("serverTimestamp"),date:new Date().toLocaleDateString("pt-BR"),guarantees:["03 ANOS P/BOILER","03 ANOS P/COLETOR SOLAR","01 ANO P/PRESSURIZADORES"],conditions:" COMBINAR"},t=a1(function(e,t,...r){if(e=eu(e),tX("collection","path",t),e instanceof aY){let n=tK.fromString(t,...r);return tJ(n),new a0(e,null,n)}{if(!(e instanceof aZ||e instanceof a0))throw new tN(tI.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(tK.fromString(t,...r));return tJ(n),new a0(e.firestore,null,n)}}(ox,"budgets"));return await oT(t,e),t.id}catch(e){return console.error("Erro ao salvar oramento no Firestore:",e),null}finally{t(!1)}},[l,u,p,r]);return{loading:e,userId:r,isAuthReady:i,client:l,items:u,totalValue:p,basePrices:a,handleClientChange:d,handleItemChange:f,saveBasePrices:m,saveBudget:g}})(),d=(0,E.useRef)(null),[f,p]=(0,E.useState)(!1),[m,g]=(0,E.useState)(!1),y=(0,E.useCallback)(async(t=!1)=>{if(!d.current)return;let r=(await e.A(14500)).default;g(!0);let n=`Orcamento_Solar_${i.nome.replace(/ /g,"_")||"Cliente"}_${new Date().toISOString().substring(0,10)}.pdf`;try{await r().set({margin:10,filename:n,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!1,scrollY:0,letterRendering:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}}).from(d.current).save(),t||alert("PDF gerado e baixado com sucesso!")}catch(e){console.error("Erro ao gerar PDF:",e),alert("Erro ao gerar o PDF. Verifique o console. (Certifique-se de que est no navegador)")}finally{g(!1)}},[i.nome]),v=async()=>{p(!0);let e=await c();e?alert(`Or\xe7amento salvo com sucesso no Firestore! ID: ${e}`):alert("Erro ao salvar o oramento. Verifique o console."),p(!1)};return t&&!n?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,b.jsxs)("div",{className:"flex flex-col items-center p-8 bg-white rounded-xl shadow-xl",children:[(0,b.jsx)(k,{className:"w-8 h-8 text-blue-500 animate-spin"}),(0,b.jsx)("p",{className:"mt-4 text-gray-700 font-medium",children:"Carregando aplicao..."})]})}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-8 font-sans",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto space-y-8",children:[(0,b.jsxs)("div",{className:"bg-cyan-600 text-white p-6 rounded-xl shadow-2xl",children:[(0,b.jsxs)("h1",{className:"text-3xl font-extrabold flex items-center",children:[(0,b.jsx)(j,{className:"w-8 h-8 mr-3 text-yellow-300"}),"A Casa dos Aquecedores"]}),(0,b.jsx)("p",{className:"mt-1 text-cyan-100",children:"Salvamento em Nuvem (Firestore)."})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-8",children:[(0,b.jsx)(oN,{client:i,handleClientChange:l}),(0,b.jsx)(oD,{items:s,handleItemChange:h,totalValue:a}),(0,b.jsxs)("div",{className:"flex justify-end space-x-4 no-print",children:[(0,b.jsx)(oR,{client:i,onGeneratePdf:()=>y(!0),isGenerating:m}),(0,b.jsxs)("button",{onClick:v,className:"bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-200 flex items-center disabled:opacity-50",disabled:f||m,children:[f?(0,b.jsx)(k,{className:"w-5 h-5 mr-2 animate-spin"}):(0,b.jsx)(D,{className:"w-5 h-5 mr-2"}),f?"Salvando...":"Salvar Oramento (Firestore)"]}),(0,b.jsxs)("button",{onClick:()=>{if(d.current){let e=d.current.outerHTML,t=window.open("","_blank");t.document.write(`
                <html>
                <head>
                    <title>Or\xe7amento Solar</title>
                    <style>
                    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Roboto+Mono:wght@400;700&display=swap');
                    body { font-family: 'Inter', sans-serif; margin: 0; padding: 20px; color: #1f2937; }
                    .budget-view { max-width: 800px; margin: 0 auto; }
                    .header-print h1 { font-size: 24px !important; }
                    .total-row-print td { background-color: #DBEAFE !important; color: #06B6D4 !important; }
                    </style>
                </head>
                <body class="p-8">
                    ${e}
                    <script>
                    setTimeout(() => {
                        window.print();
                        window.onafterprint = function() {
                        window.close();
                        };
                    }, 500);
                    </script>
                </body>
                </html>
            `),t.document.close()}},className:"bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-200 flex items-center disabled:opacity-50",disabled:m,children:[(0,b.jsx)(N,{className:"w-5 h-5 mr-2"}),"Imprimir / Gerar PDF"]})]})]}),(0,b.jsx)("div",{className:"lg:col-span-1 no-print",children:(0,b.jsx)(ok,{userId:r,isAuthReady:n,basePrices:o,saveBasePrices:u,loadingHook:t})})]}),(0,b.jsxs)("h2",{className:"text-2xl font-bold pt-8 border-t-2 mt-8 flex items-center text-gray-700",children:[(0,b.jsx)(R,{className:"w-5 h-5 mr-2 text-cyan-500"}),"Pr-visualizao do Oramento"]}),(0,b.jsx)("div",{className:"p-4 bg-gray-100 rounded-xl shadow-inner",children:(0,b.jsx)(oO,{ref:d,client:i,items:s,totalValue:a,userId:r})})]})})}],18926)},62080,(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",()=>e.r(18926)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push(["/"])})}]);